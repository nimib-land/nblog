<!DOCTYPE html>
<html lang="en-us">
<head>
  <title>drafts/polymorph_js_backend.nim</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2280%22>üê≥</text></svg>">
  <meta content="text/html; charset=utf-8" http-equiv="content-type">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link rel='stylesheet' href='https://unpkg.com/normalize.css'>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/light.min.css">
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/pietroppeter/nimib/assets/atom-one-light.css'>
  <style>
.nb-box {
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.nb-small {
  font-size: 0.8rem;
}
button.nb-small {
  float: right;
  padding: 2px;
  padding-right: 5px;
  padding-left: 5px;
}
section#source {
  display:none
}

.nb-output {
  line-height: 1.15;
}
</style>
  
  <script async defer data-domain="pietroppeter.github.io/nblog" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
<header>
<div class="nb-box">
  <span><a href="..">üè°</a></span>
  <span><code>drafts/polymorph_js_backend.nim</code></span>
  <span><a href="https://github.com/pietroppeter/nblog"><svg aria-hidden="true" width="1.2em" height="1.2em" style="vertical-align: middle;" preserveAspectRatio="xMidYMid meet" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59c.4.07.55-.17.55-.38c0-.19-.01-.82-.01-1.49c-2.01.37-2.53-.49-2.69-.94c-.09-.23-.48-.94-.82-1.13c-.28-.15-.68-.52-.01-.53c.63-.01 1.08.58 1.23.82c.72 1.21 1.87.87 2.33.66c.07-.52.28-.87.51-1.07c-1.78-.2-3.64-.89-3.64-3.95c0-.87.31-1.59.82-2.15c-.08-.2-.36-1.02.08-2.12c0 0 .67-.21 2.2.82c.64-.18 1.32-.27 2-.27c.68 0 1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82c.44 1.1.16 1.92.08 2.12c.51.56.82 1.27.82 2.15c0 3.07-1.87 3.75-3.65 3.95c.29.25.54.73.54 1.48c0 1.07-.01 1.93-.01 2.2c0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z" fill="#000"></path></svg></a></span>
</div>
<hr>
</header><main>
<p>Trying to use <a href="https://github.com/rlipsc/polymorph">polymorph</a> with nim js backend.
It does not work. File created to submit an issue.</p>
<p>The following code is executed by nimib
both using c backend and js backend.</p>
<p>If you open the browser console you will see that with js backend:</p>
<ul>
<li>it starts with Pos (0, 0) instead of (1, 1) (and wrong velociy)</li>
<li>at each step neither move nor gravity are applied, only bounce is applied.</li>
</ul>
<pre><code class="nim hljs"><span class="hljs-keyword">import</span> polymorph

<span class="hljs-comment"># Parse some types as components.</span>
register defaultCompOpts:
  <span class="hljs-keyword">type</span>
    <span class="hljs-type">Pos</span> = <span class="hljs-keyword">object</span>
      x, y: <span class="hljs-built_in">float</span>
    <span class="hljs-type">Vel</span> = <span class="hljs-keyword">object</span>
      x, y: <span class="hljs-built_in">float</span>
    <span class="hljs-type">Gravity</span> = <span class="hljs-keyword">object</span>
      strength: <span class="hljs-built_in">float</span>
    <span class="hljs-type">Bounce</span> = <span class="hljs-keyword">object</span>   <span class="hljs-comment"># A dataless 'tag' component.</span>

makeSystem <span class="hljs-string">&quot;move&quot;</span>, [<span class="hljs-type">Pos</span>, <span class="hljs-type">Vel</span>]:
  <span class="hljs-comment"># Calculate basic movement.</span>
  all:
    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;move&quot;</span>
    pos.x += vel.x
    pos.y += vel.y

makeSystem <span class="hljs-string">&quot;gravity&quot;</span>, [<span class="hljs-type">Vel</span>, <span class="hljs-type">Gravity</span>]:
  <span class="hljs-comment"># Apply a gravity force to 'Vel'.</span>
  all:
    vel.y -= gravity.strength

makeSystem <span class="hljs-string">&quot;bounce&quot;</span>, [<span class="hljs-type">Pos</span>, <span class="hljs-type">Vel</span>, <span class="hljs-type">Bounce</span>]:
  all:
    <span class="hljs-comment"># Correct 'Pos.y' to never goes below zero, enacting a simple bounce</span>
    <span class="hljs-comment"># to 'Vel.y' if this occurs.</span>
    <span class="hljs-keyword">if</span> pos.y &lt;= <span class="hljs-number">0.0</span>:
      pos.y = <span class="hljs-number">0.0</span>
      vel.y = abs(vel.y) * <span class="hljs-number">0.5</span>

<span class="hljs-comment"># Generate the framework and system procedures.</span>
makeEcsCommit <span class="hljs-string">&quot;run&quot;</span>

<span class="hljs-keyword">let</span>
  ball = newEntityWith(
    <span class="hljs-type">Pos</span>(x: <span class="hljs-number">0.0</span>, y: <span class="hljs-number">0.0</span>),
    <span class="hljs-type">Vel</span>(x: <span class="hljs-number">1.0</span>, y: <span class="hljs-number">1.0</span>),
    <span class="hljs-type">Gravity</span>(strength: <span class="hljs-number">1.0</span>),
    <span class="hljs-type">Bounce</span>()
  ) 

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> ..&lt; <span class="hljs-number">4</span>:
  run()
  <span class="hljs-keyword">echo</span> ball</code></pre><pre class="nb-output"><samp>move
[EntityId: 1 (generation: 1)
Alive: true
Components:
  Pos (id: 1, index: 1, generation: 1): (x: 1.0, y: 1.0)
  Vel (id: 2, index: 1, generation: 1): (x: 1.0, y: 0.0)
  Gravity (id: 3, index: 1, generation: 1): (strength: 1.0)
  Bounce (id: 4, index: 1, generation: 1): ()
Systems:
  move (sysMove) 
  gravity (sysGravity) 
  bounce (sysBounce) 
]
move
[EntityId: 1 (generation: 1)
Alive: true
Components:
  Pos (id: 1, index: 1, generation: 1): (x: 2.0, y: 1.0)
  Vel (id: 2, index: 1, generation: 1): (x: 1.0, y: -1.0)
  Gravity (id: 3, index: 1, generation: 1): (strength: 1.0)
  Bounce (id: 4, index: 1, generation: 1): ()
Systems:
  move (sysMove) 
  gravity (sysGravity) 
  bounce (sysBounce) 
]
move
[EntityId: 1 (generation: 1)
Alive: true
Components:
  Pos (id: 1, index: 1, generation: 1): (x: 3.0, y: 0.0)
  Vel (id: 2, index: 1, generation: 1): (x: 1.0, y: 1.0)
  Gravity (id: 3, index: 1, generation: 1): (strength: 1.0)
  Bounce (id: 4, index: 1, generation: 1): ()
Systems:
  move (sysMove) 
  gravity (sysGravity) 
  bounce (sysBounce) 
]
move
[EntityId: 1 (generation: 1)
Alive: true
Components:
  Pos (id: 1, index: 1, generation: 1): (x: 4.0, y: 1.0)
  Vel (id: 2, index: 1, generation: 1): (x: 1.0, y: 0.0)
  Gravity (id: 3, index: 1, generation: 1): (strength: 1.0)
  Bounce (id: 4, index: 1, generation: 1): ()
Systems:
  move (sysMove) 
  gravity (sysGravity) 
  bounce (sysBounce) 
]</samp></pre>

<script defer>/* Generated by the Nim Compiler v1.6.0 */
var framePtr = null;
var excHandler = 0;
var lastJSError = null;
var NTI905969736 = {size: 0,kind: 31,base: null,node: null,finalizer: null};
var NTI905969743 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI469763346 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI469763398 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI469763228 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI1140850884 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI469762185 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI469762184 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI469762183 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI33554435 = {size: 0,kind: 36,base: null,node: null,finalizer: null};
var NTI469762182 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI1140850875 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI469763403 = {size: 0, kind: 16, base: null, node: null, finalizer: null};
var NTI469763351 = {size: 0, kind: 16, base: null, node: null, finalizer: null};
var NTI33554439 = {size: 0,kind: 28,base: null,node: null,finalizer: null};
var NTI1140850879 = {size: 0,kind: 42,base: null,node: null,finalizer: null};
var NTI469763234 = {size: 0, kind: 16, base: null, node: null, finalizer: null};
var NTI33554456 = {size: 0,kind: 31,base: null,node: null,finalizer: null};
var NTI1140850871 = {size: 0,kind: 34,base: null,node: null,finalizer: null};
var NTI637534211 = {size: 0,kind: 31,base: null,node: null,finalizer: null};
var NTI469763249 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NTI469763246 = {size: 0, kind: 24, base: null, node: null, finalizer: null};
var NTI469763243 = {size: 0, kind: 18, base: null, node: null, finalizer: null};
var NNI469763249 = {kind: 2, len: 3, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "Field0", len: 0, typ: NTI637534211, name: "Field0", sons: null}, 
{kind: 1, offset: "Field1", len: 0, typ: NTI1140850871, name: "Field1", sons: null}, 
{kind: 1, offset: "Field2", len: 0, typ: NTI33554456, name: "Field2", sons: null}]};
NTI469763249.node = NNI469763249;
NTI469763246.base = NTI469763249;
var NNI469763243 = {kind: 2, len: 2, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "data", len: 0, typ: NTI469763246, name: "data", sons: null}, 
{kind: 1, offset: "counter", len: 0, typ: NTI33554456, name: "counter", sons: null}]};
NTI469763243.node = NNI469763243;
NTI469763234.base = NTI1140850879;
NTI469763351.base = NTI1140850879;
NTI469763403.base = NTI1140850879;
var NNI1140850875 = {kind: 2, len: 2, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "Field0", len: 0, typ: NTI1140850871, name: "Field0", sons: null}, 
{kind: 1, offset: "Field1", len: 0, typ: NTI1140850871, name: "Field1", sons: null}]};
NTI1140850875.node = NNI1140850875;
var NNI469762182 = {kind: 2, len: 2, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "x", len: 0, typ: NTI33554435, name: "x", sons: null}, 
{kind: 1, offset: "y", len: 0, typ: NTI33554435, name: "y", sons: null}]};
NTI469762182.node = NNI469762182;
var NNI469762183 = {kind: 2, len: 2, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "x", len: 0, typ: NTI33554435, name: "x", sons: null}, 
{kind: 1, offset: "y", len: 0, typ: NTI33554435, name: "y", sons: null}]};
NTI469762183.node = NNI469762183;
var NNI469762184 = {kind: 1, offset: "strength", len: 0, typ: NTI33554435, name: "strength", sons: null};
NTI469762184.node = NNI469762184;
var NNI469762185 = {kind: 2, len: 0, offset: 0, typ: null, name: null, sons: []};
NTI469762185.node = NNI469762185;
var NNI1140850884 = {kind: 2, len: 3, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "Field0", len: 0, typ: NTI1140850879, name: "Field0", sons: null}, 
{kind: 1, offset: "Field1", len: 0, typ: NTI1140850871, name: "Field1", sons: null}, 
{kind: 1, offset: "Field2", len: 0, typ: NTI1140850871, name: "Field2", sons: null}]};
NTI1140850884.node = NNI1140850884;
var NNI469763228 = {kind: 2, len: 3, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "entity", len: 0, typ: NTI1140850875, name: "entity", sons: null}, 
{kind: 1, offset: "pos", len: 0, typ: NTI1140850871, name: "pos", sons: null}, 
{kind: 1, offset: "vel", len: 0, typ: NTI1140850871, name: "vel", sons: null}]};
NTI469763228.node = NNI469763228;
var NNI469763398 = {kind: 2, len: 4, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "entity", len: 0, typ: NTI1140850875, name: "entity", sons: null}, 
{kind: 1, offset: "pos", len: 0, typ: NTI1140850871, name: "pos", sons: null}, 
{kind: 1, offset: "vel", len: 0, typ: NTI1140850871, name: "vel", sons: null}, 
{kind: 1, offset: "bounce", len: 0, typ: NTI1140850871, name: "bounce", sons: null}]};
NTI469763398.node = NNI469763398;
var NNI469763346 = {kind: 2, len: 3, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "entity", len: 0, typ: NTI1140850875, name: "entity", sons: null}, 
{kind: 1, offset: "vel", len: 0, typ: NTI1140850871, name: "vel", sons: null}, 
{kind: 1, offset: "gravity", len: 0, typ: NTI1140850871, name: "gravity", sons: null}]};
NTI469763346.node = NNI469763346;
var NNI905969743 = {kind: 2, len: 2, offset: 0, typ: null, name: null, sons: [{kind: 1, offset: "a", len: 0, typ: NTI905969736, name: "a", sons: null}, 
{kind: 1, offset: "b", len: 0, typ: NTI33554456, name: "b", sons: null}]};
NTI905969743.node = NNI905969743;

function setConstr() {
        var result = {};
    for (var i = 0; i < arguments.length; ++i) {
      var x = arguments[i];
      if (typeof(x) == "object") {
        for (var j = x[0]; j <= x[1]; ++j) {
          result[j] = true;
        }
      } else {
        result[x] = true;
      }
    }
    return result;
  

  
}
var ConstSet1 = setConstr(17, 16, 4, 18, 27, 19, 23, 22, 21);

function nimCopy(dest_33557141, src_33557142, ti_33557143) {
  var result_33557152 = null;

    switch (ti_33557143.kind) {
    case 21:
    case 22:
    case 23:
    case 5:
      if (!(isFatPointer_33557132(ti_33557143))) {
      result_33557152 = src_33557142;
      }
      else {
        result_33557152 = [src_33557142[0], src_33557142[1]];
      }
      
      break;
    case 19:
            if (dest_33557141 === null || dest_33557141 === undefined) {
        dest_33557141 = {};
      }
      else {
        for (var key in dest_33557141) { delete dest_33557141[key]; }
      }
      for (var key in src_33557142) { dest_33557141[key] = src_33557142[key]; }
      result_33557152 = dest_33557141;
    
      break;
    case 18:
    case 17:
      if (!((ti_33557143.base == null))) {
      result_33557152 = nimCopy(dest_33557141, src_33557142, ti_33557143.base);
      }
      else {
      if ((ti_33557143.kind == 17)) {
      result_33557152 = (dest_33557141 === null || dest_33557141 === undefined) ? {m_type: ti_33557143} : dest_33557141;
      }
      else {
        result_33557152 = (dest_33557141 === null || dest_33557141 === undefined) ? {} : dest_33557141;
      }
      }
      nimCopyAux(result_33557152, src_33557142, ti_33557143.node);
      break;
    case 24:
    case 4:
    case 27:
    case 16:
            if (src_33557142 === null) {
        result_33557152 = null;
      }
      else {
        if (dest_33557141 === null || dest_33557141 === undefined || dest_33557141.length != src_33557142.length) {
          dest_33557141 = new Array(src_33557142.length);
        }
        result_33557152 = dest_33557141;
        for (var i = 0; i < src_33557142.length; ++i) {
          result_33557152[i] = nimCopy(result_33557152[i], src_33557142[i], ti_33557143.base);
        }
      }
    
      break;
    case 28:
            if (src_33557142 !== null) {
        result_33557152 = src_33557142.slice(0);
      }
    
      break;
    default: 
      result_33557152 = src_33557142;
      break;
    }

  return result_33557152;

}

function makeNimstrLit(c_33556802) {
      var result = [];
  for (var i = 0; i < c_33556802.length; ++i) {
    result[i] = c_33556802.charCodeAt(i);
  }
  return result;
  

  
}

function toJSStr(s_33556808) {
                    var Temporary5;
            var Temporary7;

  var result_33556809 = null;

    var res_33556843 = newSeq_33556826((s_33556808).length);
    var i_33556844 = 0;
    var j_33556845 = 0;
    Label1: do {
        Label2: while (true) {
        if (!(i_33556844 < (s_33556808).length)) break Label2;
          var c_33556846 = s_33556808[i_33556844];
          if ((c_33556846 < 128)) {
          res_33556843[j_33556845] = String.fromCharCode(c_33556846);
          i_33556844 += 1;
          }
          else {
            var helper_33556858 = newSeq_33556826(0);
            Label3: do {
                Label4: while (true) {
                if (!true) break Label4;
                  var code_33556859 = c_33556846.toString(16);
                  if ((((code_33556859) == null ? 0 : (code_33556859).length) == 1)) {
                  helper_33556858.push("%0");;
                  }
                  else {
                  helper_33556858.push("%");;
                  }
                  
                  helper_33556858.push(code_33556859);;
                  i_33556844 += 1;
                    if (((s_33556808).length <= i_33556844)) Temporary5 = true; else {                      Temporary5 = (s_33556808[i_33556844] < 128);                    }                  if (Temporary5) {
                  break Label3;
                  }
                  
                  c_33556846 = s_33556808[i_33556844];
                }
            } while (false);
++excHandler;
            Temporary7 = framePtr;
            try {
            res_33556843[j_33556845] = decodeURIComponent(helper_33556858.join(""));
--excHandler;
} catch (EXCEPTION) {
 var prevJSError = lastJSError;
 lastJSError = EXCEPTION;
 --excHandler;
            framePtr = Temporary7;
            res_33556843[j_33556845] = helper_33556858.join("");
            lastJSError = prevJSError;
            } finally {
            framePtr = Temporary7;
            }
          }
          
          j_33556845 += 1;
        }
    } while (false);
    if (res_33556843.length < j_33556845) { for (var i = res_33556843.length ; i < j_33556845 ; ++i) res_33556843.push(null); }
               else { res_33556843.length = j_33556845; };
    result_33556809 = res_33556843.join("");

  return result_33556809;

}

function rawEcho() {
          var buf = "";
      for (var i = 0; i < arguments.length; ++i) {
        buf += toJSStr(arguments[i]);
      }
      console.log(buf);
    

  
}

function genericReset(x_33557172, ti_33557173) {
  var result_33557174 = null;

    result_33557174 = null;
    switch (ti_33557173.kind) {
    case 21:
    case 22:
    case 23:
    case 5:
      if (isFatPointer_33557132(ti_33557173)) {
              result_33557174 = [null, 0];
      
      }
      
      break;
    case 19:
            result_33557174 = {};
    
      break;
    case 18:
    case 17:
      if ((ti_33557173.kind == 17)) {
      result_33557174 = {m_type: ti_33557173};
      }
      else {
        result_33557174 = {};
      }
      
      break;
    case 24:
    case 27:
    case 28:
            result_33557174 = [];
    
      break;
    case 4:
    case 16:
            result_33557174 = new Array(x_33557172.length);
      for (var i = 0; i < x_33557172.length; ++i) {
        result_33557174[i] = genericReset(x_33557172[i], ti_33557173.base);
      }
    
      break;
    default: 
      break;
    }

  return result_33557174;

}

function nimMax(a_33556999, b_33557000) {
    var Temporary1;

  var result_33557001 = 0;

  BeforeRet: do {
    if ((b_33557000 <= a_33556999)) {
    Temporary1 = a_33556999;
    }
    else {
    Temporary1 = b_33557000;
    }
    
    result_33557001 = Temporary1;
    break BeforeRet;
  } while (false);

  return result_33557001;

}

function mnewString(len_33556894) {
        return new Array(len_33556894);
  

  
}
var ConstSet2 = setConstr(13, 10);

function nimMin(a_33556995, b_33556996) {
    var Temporary1;

  var result_33556997 = 0;

  BeforeRet: do {
    if ((a_33556995 <= b_33556996)) {
    Temporary1 = a_33556995;
    }
    else {
    Temporary1 = b_33556996;
    }
    
    result_33556997 = Temporary1;
    break BeforeRet;
  } while (false);

  return result_33556997;

}
        var NO_ENTITY_REF_1140851124 = {Field0: 0, Field1: 0};

function nimBoolToStr(x_33556515) {
  var result_33556516 = [];

    if (x_33556515) {
    result_33556516 = nimCopy(null, makeNimstrLit("true"), NTI33554439);
    }
    else {
      result_33556516 = nimCopy(null, makeNimstrLit("false"), NTI33554439);
    }
    

  return result_33556516;

}
if (!Math.trunc) {
  Math.trunc = function(v) {
    v = +v;
    if (!isFinite(v)) return v;
    return (v - v % 1) || (v < 0 ? -0 : v === 0 ? v : 0);
  };
}

var objectID_637534370 = [0];
var state_1459617805 = [{a0: 1773455756, a1: 4275166512}];
if (globalThis.utcInstance_1476396384 === undefined) {
  globalThis.utcInstance_1476396384 = [null];
}
if (globalThis.localInstance_1476396385 === undefined) {
  globalThis.localInstance_1476396385 = [null];
}

function nextPowerOfTwo_738197676(x_738197677) {
  var result_738197678 = 0;

    result_738197678 = (x_738197677 - 1);
    result_738197678 = (result_738197678 | (result_738197678 >> 16));
    result_738197678 = (result_738197678 | (result_738197678 >> 8));
    result_738197678 = (result_738197678 | (result_738197678 >> 4));
    result_738197678 = (result_738197678 | (result_738197678 >> 2));
    result_738197678 = (result_738197678 | (result_738197678 >> 1));
    result_738197678 += (1 + ((x_738197677 <= 0) ? 1 : 0));

  return result_738197678;

}

function slotsNeeded_721420330(count_721420331) {
  var result_721420332 = 0;

    result_721420332 = nextPowerOfTwo_738197676((Math.trunc((count_721420331 * 3) / 2) + 4));

  return result_721420332;

}

function initTable_469763879(initialSize_469763882) {
  var result_469763883 = ({data: [], counter: 0});

    var correctSizeHEX60gensym638_469763885 = slotsNeeded_721420330(initialSize_469763882);
    result_469763883.counter = 0;
    result_469763883.data = new Array(correctSizeHEX60gensym638_469763885); for (var i = 0 ; i < correctSizeHEX60gensym638_469763885 ; ++i) { result_469763883.data[i] = {Field0: 0, Field1: 0, Field2: 0}; }
  return result_469763883;

}

function isFatPointer_33557132(ti_33557133) {
  var result_33557134 = false;

  BeforeRet: do {
    result_33557134 = !((ConstSet1[ti_33557133.base.kind] != undefined));
    break BeforeRet;
  } while (false);

  return result_33557134;

}

function nimCopyAux(dest_33557145, src_33557146, n_33557147) {
    switch (n_33557147.kind) {
    case 0:
      break;
    case 1:
            dest_33557145[n_33557147.offset] = nimCopy(dest_33557145[n_33557147.offset], src_33557146[n_33557147.offset], n_33557147.typ);
    
      break;
    case 2:
          for (var i = 0; i < n_33557147.sons.length; i++) {
      nimCopyAux(dest_33557145, src_33557146, n_33557147.sons[i]);
    }
    
      break;
    case 3:
            dest_33557145[n_33557147.offset] = nimCopy(dest_33557145[n_33557147.offset], src_33557146[n_33557147.offset], n_33557147.typ);
      for (var i = 0; i < n_33557147.sons.length; ++i) {
        nimCopyAux(dest_33557145, src_33557146, n_33557147.sons[i][1]);
      }
    
      break;
    }

  
}

function initMoveSystem_469763875(value_469763876) {
    value_469763876.index = nimCopy(value_469763876.index, initTable_469763879(32), NTI469763243);
    value_469763876.streamRate = 1;
    value_469763876.requirements = nimCopy(value_469763876.requirements, [1, 2], NTI469763234);
    value_469763876.systemName = nimCopy(null, makeNimstrLit("move"), NTI33554439);
    value_469763876.id = 1;

  
}

function initGravitySystem_469764042(value_469764043) {
    value_469764043.index = nimCopy(value_469764043.index, initTable_469763879(32), NTI469763243);
    value_469764043.streamRate = 1;
    value_469764043.requirements = nimCopy(value_469764043.requirements, [2, 3], NTI469763351);
    value_469764043.systemName = nimCopy(null, makeNimstrLit("gravity"), NTI33554439);
    value_469764043.id = 2;

  
}

function initBounceSystem_469764132(value_469764133) {
    value_469764133.index = nimCopy(value_469764133.index, initTable_469763879(32), NTI469763243);
    value_469764133.streamRate = 1;
    value_469764133.requirements = nimCopy(value_469764133.requirements, [1, 2, 4], NTI469763403);
    value_469764133.systemName = nimCopy(null, makeNimstrLit("bounce"), NTI33554439);
    value_469764133.id = 3;

  
}

function initEntityStorage_469765278(value_469765279) {
    value_469765279.nextEntityId = 1;

  
}

function pop_469765489(s_469765491, s_469765491_Idx) {
  var result_469765492 = 0;

    var L_469765496 = ((s_469765491[s_469765491_Idx]).length - 1);
    result_469765492 = s_469765491[s_469765491_Idx][L_469765496];
    if (s_469765491[s_469765491_Idx].length < L_469765496) { for (var i = s_469765491[s_469765491_Idx].length ; i < L_469765496 ; ++i) s_469765491[s_469765491_Idx].push(0); }
               else { s_469765491[s_469765491_Idx].length = L_469765496; };

  return result_469765492;

}

function newEntity_469765482() {
      var Temporary1;

  var result_469765483 = {Field0: 0, Field1: 0};

    var entityId_469765484 = 0;
    if ((0 < (entityStorage_469765280[0].entityRecycler).length)) {
    entityId_469765484 = pop_469765489(entityStorage_469765280[0], "entityRecycler");
    }
    else {
      entityId_469765484 = entityStorage_469765280[0].nextEntityId;
      if (entityStorage_469765280[0].entityComponents.length < (Temporary1 = (((entityStorage_469765280[0].nextEntityId) | 0) + 1), Temporary1)) { for (var i = entityStorage_469765280[0].entityComponents.length ; i < Temporary1 ; ++i) entityStorage_469765280[0].entityComponents.push(({setup: false, instance: 0, componentRefs: []})); }
               else { entityStorage_469765280[0].entityComponents.length = Temporary1; };
      entityStorage_469765280[0].nextEntityId = (((entityStorage_469765280[0].entityComponents).length) | 0);
    }
    
    entityStorage_469765280[0].entityCounter += 1;
    entityStorage_469765280[0].entityComponents[entityId_469765484].setup = true;
    var iHEX60gensym132_469765515 = (entityStorage_469765280[0].entityComponents[entityId_469765484].instance + 1);
    entityStorage_469765280[0].entityComponents[entityId_469765484].instance = iHEX60gensym132_469765515;
    result_469765483 = nimCopy(result_469765483, {Field0: entityId_469765484, Field1: iHEX60gensym132_469765515}, NTI1140850875);

  return result_469765483;

}

function pop_469764294(s_469764296, s_469764296_Idx) {
  var result_469764297 = 0;

    var L_469764301 = ((s_469764296[s_469764296_Idx]).length - 1);
    result_469764297 = s_469764296[s_469764296_Idx][L_469764301];
    if (s_469764296[s_469764296_Idx].length < L_469764301) { for (var i = s_469764296[s_469764296_Idx].length ; i < L_469764301 ; ++i) s_469764296[s_469764296_Idx].push(0); }
               else { s_469764296[s_469764296_Idx].length = L_469764301; };

  return result_469764297;

}

function newInstance_469764428(value_469764429) {
  var result_469764430 = 0;

    var rHEX60gensym65_469764431 = 0;
    if ((0 < (posFreeIndexes_469764206[0]).length)) {
    rHEX60gensym65_469764431 = pop_469764294(posFreeIndexes_469764206, 0);
    }
    else {
      var newLenHEX60gensym62_469764441 = ((storagePos_469764205[0]).length + 1);
      if (storagePos_469764205[0].length < newLenHEX60gensym62_469764441) { for (var i = storagePos_469764205[0].length ; i < newLenHEX60gensym62_469764441 ; ++i) storagePos_469764205[0].push(({x: 0.0, y: 0.0})); }
               else { storagePos_469764205[0].length = newLenHEX60gensym62_469764441; };
      if (posInstanceIds_469764209[0].length < newLenHEX60gensym62_469764441) { for (var i = posInstanceIds_469764209[0].length ; i < newLenHEX60gensym62_469764441 ; ++i) posInstanceIds_469764209[0].push(0); }
               else { posInstanceIds_469764209[0].length = newLenHEX60gensym62_469764441; };
      if (posAlive_469764208[0].length < newLenHEX60gensym62_469764441) { for (var i = posAlive_469764208[0].length ; i < newLenHEX60gensym62_469764441 ; ++i) posAlive_469764208[0].push(false); }
               else { posAlive_469764208[0].length = newLenHEX60gensym62_469764441; };
      rHEX60gensym65_469764431 = (((storagePos_469764205[0]).length - 1) | 0);
    }
    
    posAlive_469764208[0][rHEX60gensym65_469764431] = true;
    posInstanceIds_469764209[0][rHEX60gensym65_469764431] += 1;
    result_469764430 = rHEX60gensym65_469764431;
    storagePos_469764205[0][result_469764430] = nimCopy(storagePos_469764205[0][result_469764430], value_469764429, NTI469762182);

  return result_469764430;

}

function pop_469764530(s_469764532, s_469764532_Idx) {
  var result_469764533 = 0;

    var L_469764537 = ((s_469764532[s_469764532_Idx]).length - 1);
    result_469764533 = s_469764532[s_469764532_Idx][L_469764537];
    if (s_469764532[s_469764532_Idx].length < L_469764537) { for (var i = s_469764532[s_469764532_Idx].length ; i < L_469764537 ; ++i) s_469764532[s_469764532_Idx].push(0); }
               else { s_469764532[s_469764532_Idx].length = L_469764537; };

  return result_469764533;

}

function newInstance_469764663(value_469764664) {
  var result_469764665 = 0;

    var rHEX60gensym79_469764666 = 0;
    if ((0 < (velFreeIndexes_469764211[0]).length)) {
    rHEX60gensym79_469764666 = pop_469764530(velFreeIndexes_469764211, 0);
    }
    else {
      var newLenHEX60gensym76_469764676 = ((storageVel_469764210[0]).length + 1);
      if (storageVel_469764210[0].length < newLenHEX60gensym76_469764676) { for (var i = storageVel_469764210[0].length ; i < newLenHEX60gensym76_469764676 ; ++i) storageVel_469764210[0].push(({x: 0.0, y: 0.0})); }
               else { storageVel_469764210[0].length = newLenHEX60gensym76_469764676; };
      if (velInstanceIds_469764214[0].length < newLenHEX60gensym76_469764676) { for (var i = velInstanceIds_469764214[0].length ; i < newLenHEX60gensym76_469764676 ; ++i) velInstanceIds_469764214[0].push(0); }
               else { velInstanceIds_469764214[0].length = newLenHEX60gensym76_469764676; };
      if (velAlive_469764213[0].length < newLenHEX60gensym76_469764676) { for (var i = velAlive_469764213[0].length ; i < newLenHEX60gensym76_469764676 ; ++i) velAlive_469764213[0].push(false); }
               else { velAlive_469764213[0].length = newLenHEX60gensym76_469764676; };
      rHEX60gensym79_469764666 = (((storageVel_469764210[0]).length - 1) | 0);
    }
    
    velAlive_469764213[0][rHEX60gensym79_469764666] = true;
    velInstanceIds_469764214[0][rHEX60gensym79_469764666] += 1;
    result_469764665 = rHEX60gensym79_469764666;
    storageVel_469764210[0][result_469764665] = nimCopy(storageVel_469764210[0][result_469764665], value_469764664, NTI469762183);

  return result_469764665;

}

function pop_469764765(s_469764767, s_469764767_Idx) {
  var result_469764768 = 0;

    var L_469764772 = ((s_469764767[s_469764767_Idx]).length - 1);
    result_469764768 = s_469764767[s_469764767_Idx][L_469764772];
    if (s_469764767[s_469764767_Idx].length < L_469764772) { for (var i = s_469764767[s_469764767_Idx].length ; i < L_469764772 ; ++i) s_469764767[s_469764767_Idx].push(0); }
               else { s_469764767[s_469764767_Idx].length = L_469764772; };

  return result_469764768;

}

function newInstance_469764898(value_469764899) {
  var result_469764900 = 0;

    var rHEX60gensym93_469764901 = 0;
    if ((0 < (gravityFreeIndexes_469764216[0]).length)) {
    rHEX60gensym93_469764901 = pop_469764765(gravityFreeIndexes_469764216, 0);
    }
    else {
      var newLenHEX60gensym90_469764911 = ((storageGravity_469764215[0]).length + 1);
      if (storageGravity_469764215[0].length < newLenHEX60gensym90_469764911) { for (var i = storageGravity_469764215[0].length ; i < newLenHEX60gensym90_469764911 ; ++i) storageGravity_469764215[0].push(({strength: 0.0})); }
               else { storageGravity_469764215[0].length = newLenHEX60gensym90_469764911; };
      if (gravityInstanceIds_469764219[0].length < newLenHEX60gensym90_469764911) { for (var i = gravityInstanceIds_469764219[0].length ; i < newLenHEX60gensym90_469764911 ; ++i) gravityInstanceIds_469764219[0].push(0); }
               else { gravityInstanceIds_469764219[0].length = newLenHEX60gensym90_469764911; };
      if (gravityAlive_469764218[0].length < newLenHEX60gensym90_469764911) { for (var i = gravityAlive_469764218[0].length ; i < newLenHEX60gensym90_469764911 ; ++i) gravityAlive_469764218[0].push(false); }
               else { gravityAlive_469764218[0].length = newLenHEX60gensym90_469764911; };
      rHEX60gensym93_469764901 = (((storageGravity_469764215[0]).length - 1) | 0);
    }
    
    gravityAlive_469764218[0][rHEX60gensym93_469764901] = true;
    gravityInstanceIds_469764219[0][rHEX60gensym93_469764901] += 1;
    result_469764900 = rHEX60gensym93_469764901;
    storageGravity_469764215[0][result_469764900] = nimCopy(storageGravity_469764215[0][result_469764900], value_469764899, NTI469762184);

  return result_469764900;

}

function pop_469765000(s_469765002, s_469765002_Idx) {
  var result_469765003 = 0;

    var L_469765007 = ((s_469765002[s_469765002_Idx]).length - 1);
    result_469765003 = s_469765002[s_469765002_Idx][L_469765007];
    if (s_469765002[s_469765002_Idx].length < L_469765007) { for (var i = s_469765002[s_469765002_Idx].length ; i < L_469765007 ; ++i) s_469765002[s_469765002_Idx].push(0); }
               else { s_469765002[s_469765002_Idx].length = L_469765007; };

  return result_469765003;

}

function newInstance_469765133(value_469765134) {
  var result_469765135 = 0;

    var rHEX60gensym107_469765136 = 0;
    if ((0 < (bounceFreeIndexes_469764221[0]).length)) {
    rHEX60gensym107_469765136 = pop_469765000(bounceFreeIndexes_469764221, 0);
    }
    else {
      var newLenHEX60gensym104_469765146 = ((storageBounce_469764220[0]).length + 1);
      if (storageBounce_469764220[0].length < newLenHEX60gensym104_469765146) { for (var i = storageBounce_469764220[0].length ; i < newLenHEX60gensym104_469765146 ; ++i) storageBounce_469764220[0].push(({})); }
               else { storageBounce_469764220[0].length = newLenHEX60gensym104_469765146; };
      if (bounceInstanceIds_469764224[0].length < newLenHEX60gensym104_469765146) { for (var i = bounceInstanceIds_469764224[0].length ; i < newLenHEX60gensym104_469765146 ; ++i) bounceInstanceIds_469764224[0].push(0); }
               else { bounceInstanceIds_469764224[0].length = newLenHEX60gensym104_469765146; };
      if (bounceAlive_469764223[0].length < newLenHEX60gensym104_469765146) { for (var i = bounceAlive_469764223[0].length ; i < newLenHEX60gensym104_469765146 ; ++i) bounceAlive_469764223[0].push(false); }
               else { bounceAlive_469764223[0].length = newLenHEX60gensym104_469765146; };
      rHEX60gensym107_469765136 = (((storageBounce_469764220[0]).length - 1) | 0);
    }
    
    bounceAlive_469764223[0][rHEX60gensym107_469765136] = true;
    bounceInstanceIds_469764224[0][rHEX60gensym107_469765136] += 1;
    result_469765135 = rHEX60gensym107_469765136;
    storageBounce_469764220[0][result_469765135] = nimCopy(storageBounce_469764220[0][result_469765135], value_469765134, NTI469762185);

  return result_469765135;

}

function hasJsBigInt_687865899() {
  var result_687865900 = false;

    result_687865900 = typeof BigInt != 'undefined'

  return result_687865900;

}

function hiXorLoJs_637534293(a_637534294, b_637534295) {
  var result_637534296 = 0n;

    var prod_637534297 = (a_637534294 * b_637534295);
    var mask_637534298 = BigInt("0xffffffffffffffff");
    result_637534296 = ((prod_637534297 >> BigInt("64")) ^ (prod_637534297 & mask_637534298));

  return result_637534296;

}

function hashWangYi1_637534386(x_637534388) {
  var result_637534389 = 0;

    if (hasJsBigInt_687865899()) {
    var P0HEX60gensym6_637534408 = BigInt("0xa0761d6478bd642f");
    var P1HEX60gensym6_637534409 = BigInt("0xe7037ed1a0b428db");
    var P58HEX60gensym6_637534410 = BigInt("0xeb44accab455d16d");
    var resHEX60gensym6_637534411 = hiXorLoJs_637534293(hiXorLoJs_637534293(P0HEX60gensym6_637534408, (BigInt(x_637534388) ^ P1HEX60gensym6_637534409)), P58HEX60gensym6_637534410);
    result_637534389 = Number((() => { const i = resHEX60gensym6_637534411, b = 32; return BigInt.asIntN(b, i) })());
    }
    else {
      result_637534389 = (x_637534388 & 4294967295);
    }
    

  return result_637534389;

}

function hash_469763978(x_469763980) {
  var result_469763981 = 0;

    result_469763981 = hashWangYi1_637534386(x_469763980);

  return result_469763981;

}

function isFilled_721420319(hcode_721420320) {
  var result_721420321 = false;

    result_721420321 = !((hcode_721420320 == 0));

  return result_721420321;

}

function HEX3DHEX3D_1140851215(e1_1140851216, e2_1140851217) {
  var result_1140851218 = false;

    result_1140851218 = (e1_1140851216 == e2_1140851217);

  return result_1140851218;

}

function nextTry_721420322(h_721420323, maxHash_721420324) {
  var result_721420325 = 0;

    result_721420325 = ((h_721420323 + 1) & maxHash_721420324);

  return result_721420325;

}

function rawGet_469763971(t_469763974, key_469763975, hc_469763976, hc_469763976_Idx) {
            var Temporary3;

  var result_469763977 = 0;

  BeforeRet: do {
    hc_469763976[hc_469763976_Idx] = hash_469763978(key_469763975);
    if ((hc_469763976[hc_469763976_Idx] == 0)) {
    hc_469763976[hc_469763976_Idx] = 314159265;
    }
    
    if (((t_469763974.data).length == 0)) {
    result_469763977 = -1;
    break BeforeRet;
    }
    
    var h_469764000 = (hc_469763976[hc_469763976_Idx] & (t_469763974.data).length - 1);
    Label1: do {
        Label2: while (true) {
        if (!isFilled_721420319(t_469763974.data[h_469764000].Field0)) break Label2;
            if (!(t_469763974.data[h_469764000].Field0 == hc_469763976[hc_469763976_Idx])) Temporary3 = false; else {              Temporary3 = HEX3DHEX3D_1140851215(t_469763974.data[h_469764000].Field1, key_469763975);            }          if (Temporary3) {
          result_469763977 = h_469764000;
          break BeforeRet;
          }
          
          h_469764000 = nextTry_721420322(h_469764000, (t_469763974.data).length - 1);
        }
    } while (false);
    result_469763977 = (-1 - h_469764000);
  } while (false);

  return result_469763977;

}

function mustRehash_469767200(t_469767202) {
  var result_469767203 = false;

    result_469767203 = ((((t_469767202.data).length * 2) < (t_469767202.counter * 3)) || (((t_469767202.data).length - t_469767202.counter) < 4));

  return result_469767203;

}

function rawInsert_469767275(t_469767279, data_469767280, data_469767280_Idx, key_469767281, val_469767282, hc_469767283, h_469767284) {
    data_469767280[data_469767280_Idx][h_469767284].Field1 = key_469767281;
    data_469767280[data_469767280_Idx][h_469767284].Field2 = val_469767282;
    data_469767280[data_469767280_Idx][h_469767284].Field0 = hc_469767283;

  
}

function enlarge_469767233(t_469767236) {
    var n_469767239 = [];
    n_469767239 = new Array(((t_469767236.data).length * 2)); for (var i = 0 ; i < ((t_469767236.data).length * 2) ; ++i) { n_469767239[i] = {Field0: 0, Field1: 0, Field2: 0}; }    var Temporary1 = t_469767236.data; t_469767236.data = n_469767239; n_469767239 = Temporary1;    Label2: do {
      var i_469767263 = 0;
      var colontmp__469780083 = 0;
      colontmp__469780083 = (n_469767239).length - 1;
      var res_469780085 = 0;
      Label3: do {
          Label4: while (true) {
          if (!(res_469780085 <= colontmp__469780083)) break Label4;
            i_469767263 = res_469780085;
            var eh_469767264 = n_469767239[i_469767263].Field0;
            if (isFilled_721420319(eh_469767264)) {
            var j_469767268 = (eh_469767264 & (t_469767236.data).length - 1);
            Label5: do {
                Label6: while (true) {
                if (!isFilled_721420319(t_469767236.data[j_469767268].Field0)) break Label6;
                  j_469767268 = nextTry_721420322(j_469767268, (t_469767236.data).length - 1);
                }
            } while (false);
            rawInsert_469767275(t_469767236, t_469767236, "data", n_469767239[i_469767263].Field1, n_469767239[i_469767263].Field2, eh_469767264, j_469767268);
            }
            
            res_469780085 += 1;
          }
      } while (false);
    } while (false);

  
}

function rawGetKnownHC_469767285(t_469767288, key_469767289, hc_469767290) {
  var result_469767291 = 0;

  BeforeRet: do {
    if (((t_469767288.data).length == 0)) {
    result_469767291 = -1;
    break BeforeRet;
    }
    
    var h_469767302 = (hc_469767290 & (t_469767288.data).length - 1);
    Label1: do {
        Label2: while (true) {
        if (!isFilled_721420319(t_469767288.data[h_469767302].Field0)) break Label2;
          if (((t_469767288.data[h_469767302].Field0 == hc_469767290) && HEX3DHEX3D_1140851215(t_469767288.data[h_469767302].Field1, key_469767289))) {
          result_469767291 = h_469767302;
          break BeforeRet;
          }
          
          h_469767302 = nextTry_721420322(h_469767302, (t_469767288.data).length - 1);
        }
    } while (false);
    result_469767291 = (-1 - h_469767302);
  } while (false);

  return result_469767291;

}

function HEX5BHEX5DHEX3D_469767160(t_469767163, key_469767164, val_469767165) {
    if (((t_469767163.data).length == 0)) {
    var correctSizeHEX60gensym910_469767174 = slotsNeeded_721420330(32);
    t_469767163.counter = 0;
    t_469767163.data = new Array(correctSizeHEX60gensym910_469767174); for (var i = 0 ; i < correctSizeHEX60gensym910_469767174 ; ++i) { t_469767163.data[i] = {Field0: 0, Field1: 0, Field2: 0}; }    }
    
    var hc_469767179 = [0];
    var index_469767186 = rawGet_469763971(t_469767163, key_469767164, hc_469767179, 0);
    if ((0 <= index_469767186)) {
    t_469767163.data[index_469767186].Field2 = val_469767165;
    }
    else {
      if (((t_469767163.data).length == 0)) {
      var correctSizeHEX60gensym913_469767195 = slotsNeeded_721420330(32);
      t_469767163.counter = 0;
      t_469767163.data = new Array(correctSizeHEX60gensym913_469767195); for (var i = 0 ; i < correctSizeHEX60gensym913_469767195 ; ++i) { t_469767163.data[i] = {Field0: 0, Field1: 0, Field2: 0}; }      }
      
      if (mustRehash_469767200(t_469767163)) {
      enlarge_469767233(t_469767163);
      index_469767186 = rawGetKnownHC_469767285(t_469767163, key_469767164, hc_469767179[0]);
      }
      
      index_469767186 = (-1 - index_469767186);
      rawInsert_469767275(t_469767163, t_469767163, "data", key_469767164, val_469767165, hc_469767179[0], index_469767186);
      t_469767163.counter += 1;
    }
    

  
}

function newSeq_33556826(len_33556828) {
  var result_33556829 = [];

    result_33556829 = new Array(len_33556828); for (var i = 0 ; i < len_33556828 ; ++i) { result_33556829[i] = null; }
  return result_33556829;

}

function HEX2BHEX3D_872417266(x_872417268, x_872417268_Idx, y_872417269) {
    x_872417268[x_872417268_Idx] = (x_872417268[x_872417268_Idx] + y_872417269);

  
}

function getOrDefault_469766942(t_469766945, key_469766946, default_469766947) {
    var Temporary1;

  var result_469766948 = 0;

    var hcHEX60gensym896_469766951 = [0];
    var indexHEX60gensym896_469766958 = rawGet_469763971(t_469766945, key_469766946, hcHEX60gensym896_469766951, 0);
    if ((0 <= indexHEX60gensym896_469766958)) {
    Temporary1 = t_469766945.data[indexHEX60gensym896_469766958].Field2;
    }
    else {
    Temporary1 = default_469766947;
    }
    
    result_469766948 = Temporary1;

  return result_469766948;

}

function isEmpty_721420316(hcode_721420317) {
  var result_721420318 = false;

    result_721420318 = (hcode_721420317 == 0);

  return result_721420318;

}

function del_469767008(t_469767011, key_469767012) {
                    var Temporary6;
                    var Temporary7;
                    var Temporary8;
                      var Temporary9;
                      var Temporary10;

    var hc_469767013 = [0];
    var i_469767020 = rawGet_469763971(t_469767011, key_469767012, hc_469767013, 0);
    var mskHEX60gensym36_469767024 = (t_469767011.data).length - 1;
    if ((0 <= i_469767020)) {
    t_469767011.counter -= 1;
    Label1: do {
      Label2: do {
          Label3: while (true) {
          if (!true) break Label3;
            var jHEX60gensym36_469767030 = i_469767020;
            var rHEX60gensym36_469767031 = jHEX60gensym36_469767030;
            t_469767011.data[i_469767020].Field0 = 0;
            t_469767011.data[i_469767020].Field1 = 0;
            t_469767011.data[i_469767020].Field2 = 0;
            Label4: do {
                Label5: while (true) {
                if (!true) break Label5;
                  i_469767020 = ((i_469767020 + 1) & mskHEX60gensym36_469767024);
                  if (isEmpty_721420316(t_469767011.data[i_469767020].Field0)) {
                  break Label1;
                  }
                  
                  rHEX60gensym36_469767031 = (t_469767011.data[i_469767020].Field0 & mskHEX60gensym36_469767024);
                    if (!(rHEX60gensym36_469767031 <= i_469767020)) Temporary8 = false; else {                      Temporary8 = (jHEX60gensym36_469767030 < rHEX60gensym36_469767031);                    }                    if (Temporary8) Temporary7 = true; else {                      if (!(jHEX60gensym36_469767030 < rHEX60gensym36_469767031)) Temporary9 = false; else {                        Temporary9 = (i_469767020 < jHEX60gensym36_469767030);                      }                      Temporary7 = Temporary9;                    }                    if (Temporary7) Temporary6 = true; else {                      if (!(i_469767020 < jHEX60gensym36_469767030)) Temporary10 = false; else {                        Temporary10 = (rHEX60gensym36_469767031 <= i_469767020);                      }                      Temporary6 = Temporary10;                    }                  if (!(Temporary6)) {
                  break Label4;
                  }
                  
                }
            } while (false);
            t_469767011.data[jHEX60gensym36_469767030] = nimCopy(t_469767011.data[jHEX60gensym36_469767030], t_469767011.data[i_469767020], NTI469763249);
          }
      } while (false);
    } while (false);
    }
    

  
}

function delete_469764363(instance_469764364) {
    var idx_469764365 = ((instance_469764364) | 0);
    if (posAlive_469764208[0][idx_469764365]) {
    posAlive_469764208[0][idx_469764365] = false;
    if ((idx_469764365 == (storagePos_469764205[0]).length - 1)) {
    var newLenHEX60gensym63_469764379 = nimMax(1, ((storagePos_469764205[0]).length - 1));
    if (storagePos_469764205[0].length < newLenHEX60gensym63_469764379) { for (var i = storagePos_469764205[0].length ; i < newLenHEX60gensym63_469764379 ; ++i) storagePos_469764205[0].push(({x: 0.0, y: 0.0})); }
               else { storagePos_469764205[0].length = newLenHEX60gensym63_469764379; };
    if (posInstanceIds_469764209[0].length < newLenHEX60gensym63_469764379) { for (var i = posInstanceIds_469764209[0].length ; i < newLenHEX60gensym63_469764379 ; ++i) posInstanceIds_469764209[0].push(0); }
               else { posInstanceIds_469764209[0].length = newLenHEX60gensym63_469764379; };
    if (posAlive_469764208[0].length < newLenHEX60gensym63_469764379) { for (var i = posAlive_469764208[0].length ; i < newLenHEX60gensym63_469764379 ; ++i) posAlive_469764208[0].push(false); }
               else { posAlive_469764208[0].length = newLenHEX60gensym63_469764379; };
    }
    else {
    if (((posFreeIndexes_469764206[0]).length - 1 == (storagePos_469764205[0]).length - 1)) {
    if (posFreeIndexes_469764206[0].length < 0) { for (var i = posFreeIndexes_469764206[0].length ; i < 0 ; ++i) posFreeIndexes_469764206[0].push(0); }
               else { posFreeIndexes_469764206[0].length = 0; };
    }
    else {
    posFreeIndexes_469764206[0].push(((idx_469764365) | 0));;
    }
    }
    }
    

  
}

function delete_469764599(instance_469764600) {
    var idx_469764601 = ((instance_469764600) | 0);
    if (velAlive_469764213[0][idx_469764601]) {
    velAlive_469764213[0][idx_469764601] = false;
    if ((idx_469764601 == (storageVel_469764210[0]).length - 1)) {
    var newLenHEX60gensym77_469764614 = nimMax(1, ((storageVel_469764210[0]).length - 1));
    if (storageVel_469764210[0].length < newLenHEX60gensym77_469764614) { for (var i = storageVel_469764210[0].length ; i < newLenHEX60gensym77_469764614 ; ++i) storageVel_469764210[0].push(({x: 0.0, y: 0.0})); }
               else { storageVel_469764210[0].length = newLenHEX60gensym77_469764614; };
    if (velInstanceIds_469764214[0].length < newLenHEX60gensym77_469764614) { for (var i = velInstanceIds_469764214[0].length ; i < newLenHEX60gensym77_469764614 ; ++i) velInstanceIds_469764214[0].push(0); }
               else { velInstanceIds_469764214[0].length = newLenHEX60gensym77_469764614; };
    if (velAlive_469764213[0].length < newLenHEX60gensym77_469764614) { for (var i = velAlive_469764213[0].length ; i < newLenHEX60gensym77_469764614 ; ++i) velAlive_469764213[0].push(false); }
               else { velAlive_469764213[0].length = newLenHEX60gensym77_469764614; };
    }
    else {
    if (((velFreeIndexes_469764211[0]).length - 1 == (storageVel_469764210[0]).length - 1)) {
    if (velFreeIndexes_469764211[0].length < 0) { for (var i = velFreeIndexes_469764211[0].length ; i < 0 ; ++i) velFreeIndexes_469764211[0].push(0); }
               else { velFreeIndexes_469764211[0].length = 0; };
    }
    else {
    velFreeIndexes_469764211[0].push(((idx_469764601) | 0));;
    }
    }
    }
    

  
}

function delete_469764834(instance_469764835) {
    var idx_469764836 = ((instance_469764835) | 0);
    if (gravityAlive_469764218[0][idx_469764836]) {
    gravityAlive_469764218[0][idx_469764836] = false;
    if ((idx_469764836 == (storageGravity_469764215[0]).length - 1)) {
    var newLenHEX60gensym91_469764849 = nimMax(1, ((storageGravity_469764215[0]).length - 1));
    if (storageGravity_469764215[0].length < newLenHEX60gensym91_469764849) { for (var i = storageGravity_469764215[0].length ; i < newLenHEX60gensym91_469764849 ; ++i) storageGravity_469764215[0].push(({strength: 0.0})); }
               else { storageGravity_469764215[0].length = newLenHEX60gensym91_469764849; };
    if (gravityInstanceIds_469764219[0].length < newLenHEX60gensym91_469764849) { for (var i = gravityInstanceIds_469764219[0].length ; i < newLenHEX60gensym91_469764849 ; ++i) gravityInstanceIds_469764219[0].push(0); }
               else { gravityInstanceIds_469764219[0].length = newLenHEX60gensym91_469764849; };
    if (gravityAlive_469764218[0].length < newLenHEX60gensym91_469764849) { for (var i = gravityAlive_469764218[0].length ; i < newLenHEX60gensym91_469764849 ; ++i) gravityAlive_469764218[0].push(false); }
               else { gravityAlive_469764218[0].length = newLenHEX60gensym91_469764849; };
    }
    else {
    if (((gravityFreeIndexes_469764216[0]).length - 1 == (storageGravity_469764215[0]).length - 1)) {
    if (gravityFreeIndexes_469764216[0].length < 0) { for (var i = gravityFreeIndexes_469764216[0].length ; i < 0 ; ++i) gravityFreeIndexes_469764216[0].push(0); }
               else { gravityFreeIndexes_469764216[0].length = 0; };
    }
    else {
    gravityFreeIndexes_469764216[0].push(((idx_469764836) | 0));;
    }
    }
    }
    

  
}

function delete_469765069(instance_469765070) {
    var idx_469765071 = ((instance_469765070) | 0);
    if (bounceAlive_469764223[0][idx_469765071]) {
    bounceAlive_469764223[0][idx_469765071] = false;
    if ((idx_469765071 == (storageBounce_469764220[0]).length - 1)) {
    var newLenHEX60gensym105_469765084 = nimMax(1, ((storageBounce_469764220[0]).length - 1));
    if (storageBounce_469764220[0].length < newLenHEX60gensym105_469765084) { for (var i = storageBounce_469764220[0].length ; i < newLenHEX60gensym105_469765084 ; ++i) storageBounce_469764220[0].push(({})); }
               else { storageBounce_469764220[0].length = newLenHEX60gensym105_469765084; };
    if (bounceInstanceIds_469764224[0].length < newLenHEX60gensym105_469765084) { for (var i = bounceInstanceIds_469764224[0].length ; i < newLenHEX60gensym105_469765084 ; ++i) bounceInstanceIds_469764224[0].push(0); }
               else { bounceInstanceIds_469764224[0].length = newLenHEX60gensym105_469765084; };
    if (bounceAlive_469764223[0].length < newLenHEX60gensym105_469765084) { for (var i = bounceAlive_469764223[0].length ; i < newLenHEX60gensym105_469765084 ; ++i) bounceAlive_469764223[0].push(false); }
               else { bounceAlive_469764223[0].length = newLenHEX60gensym105_469765084; };
    }
    else {
    if (((bounceFreeIndexes_469764221[0]).length - 1 == (storageBounce_469764220[0]).length - 1)) {
    if (bounceFreeIndexes_469764221[0].length < 0) { for (var i = bounceFreeIndexes_469764221[0].length ; i < 0 ; ++i) bounceFreeIndexes_469764221[0].push(0); }
               else { bounceFreeIndexes_469764221[0].length = 0; };
    }
    else {
    bounceFreeIndexes_469764221[0].push(((idx_469765071) | 0));;
    }
    }
    }
    

  
}

function doDelete_469766725(entity_469766726) {
      var Temporary1;
      var Temporary2;
      var Temporary3;
      var Temporary4;
      var Temporary5;
                    var Temporary12;
                    var Temporary13;
                    var Temporary14;
                    var Temporary15;
                    var Temporary16;
                    var Temporary17;
                    var Temporary18;
                    var Temporary19;
                    var Temporary20;
                    var Temporary21;
                    var Temporary22;
                    var Temporary23;
                    var Temporary24;
                    var Temporary25;

  BeforeRet: do {
    var entityId_469766839 = entity_469766726.Field0;
      if (!!(HEX3DHEX3D_1140851215(entity_469766726.Field0, 0))) Temporary5 = false; else {        Temporary5 = (1 <= ((entity_469766726.Field0) | 0));      }      if (!Temporary5) Temporary4 = false; else {        Temporary4 = (((entity_469766726.Field0) | 0) <= (entityStorage_469765280[0].entityComponents).length);      }      if (!Temporary4) Temporary3 = false; else {        Temporary3 = entityStorage_469765280[0].entityComponents[entity_469766726.Field0].setup;      }      if (!Temporary3) Temporary2 = false; else {        Temporary2 = (((entityStorage_469765280[0].entityComponents[entity_469766726.Field0].instance) | 0) == ((entity_469766726.Field1) | 0));      }      if (!(Temporary2)) Temporary1 = true; else {        Temporary1 = !(entityStorage_469765280[0].entityComponents[entityId_469766839].setup);      }    if (Temporary1) {
    break BeforeRet;
    }
    
    var sysProcessed_469763352 = {};
    Label6: do {
      Label7: do {
        var curComp_469763351 = {Field0: 0, Field1: 0, Field2: 0};
        Label8: do {
          var compHEX60gensym128_469780112 = {Field0: 0, Field1: 0, Field2: 0};
          Label9: do {
            var itemHEX60gensym127_469780114 = null;
            var colontmp__469780115 = [];
            colontmp__469780115 = entityStorage_469765280[0].entityComponents[entity_469766726.Field0].componentRefs;
            var i_469780116 = 0;
            var L_469780117 = (colontmp__469780115).length;
            Label10: do {
                Label11: while (true) {
                if (!(i_469780116 < L_469780117)) break Label11;
                  itemHEX60gensym127_469780114 = colontmp__469780115[i_469780116];
                  compHEX60gensym128_469780112 = nimCopy(compHEX60gensym128_469780112, itemHEX60gensym127_469780114, NTI1140850884);
                  curComp_469763351 = nimCopy(curComp_469763351, compHEX60gensym128_469780112, NTI1140850884);
                  switch (((curComp_469763351.Field0) | 0)) {
                  case 1:
                    var sysFetchmove__TzJMNLY39cRyxRwwZlBOWVQ_469766875 = {Field0: false, Field1: 0};
                    sysFetchmove__TzJMNLY39cRyxRwwZlBOWVQ_469766875.Field1 = getOrDefault_469766942(sysMove_469763872[0].index, entity_469766726.Field0, -1);
                    sysFetchmove__TzJMNLY39cRyxRwwZlBOWVQ_469766875.Field0 = (0 <= sysFetchmove__TzJMNLY39cRyxRwwZlBOWVQ_469766875.Field1);
                    if (!((sysProcessed_469763352[1] != undefined))) {
                    sysProcessed_469763352[1] = true;
                    if (sysFetchmove__TzJMNLY39cRyxRwwZlBOWVQ_469766875.Field0) {
                    del_469767008(sysMove_469763872[0].index, entity_469766726.Field0);
                    var topIdxHEX60gensym180_469767083 = (sysMove_469763872[0].groups).length - 1;
                    var riHEX60gensym180_469767084 = sysFetchmove__TzJMNLY39cRyxRwwZlBOWVQ_469766875.Field1;
                    if ((riHEX60gensym180_469767084 < topIdxHEX60gensym180_469767083)) {
                    Temporary12 = sysMove_469763872[0].groups[topIdxHEX60gensym180_469767083];
                    sysMove_469763872[0].groups[topIdxHEX60gensym180_469767083] = genericReset(sysMove_469763872[0].groups[topIdxHEX60gensym180_469767083], NTI469763228);
                    sysMove_469763872[0].groups[riHEX60gensym180_469767084] = nimCopy(sysMove_469763872[0].groups[riHEX60gensym180_469767084], Temporary12, NTI469763228);
                    var updatedRowEnt_469763389 = nimCopy(null, sysMove_469763872[0].groups[riHEX60gensym180_469767084].entity, NTI1140850875);
                    HEX5BHEX5DHEX3D_469767160(sysMove_469763872[0].index, updatedRowEnt_469763389.Field0, sysFetchmove__TzJMNLY39cRyxRwwZlBOWVQ_469766875.Field1);
                    }
                    
                    if (sysMove_469763872[0].groups.length < (Temporary13 = ((sysMove_469763872[0].groups).length - 1), Temporary13)) { for (var i = sysMove_469763872[0].groups.length ; i < Temporary13 ; ++i) sysMove_469763872[0].groups.push(({entity: {Field0: 0, Field1: 0}, pos: 0, vel: 0})); }
               else { sysMove_469763872[0].groups.length = Temporary13; };
                    }
                    
                    }
                    
                    var sysFetchbounce__TzJMNLY39cRyxRwwZlBOWVQ_469767337 = {Field0: false, Field1: 0};
                    sysFetchbounce__TzJMNLY39cRyxRwwZlBOWVQ_469767337.Field1 = getOrDefault_469766942(sysBounce_469764129[0].index, entity_469766726.Field0, -1);
                    sysFetchbounce__TzJMNLY39cRyxRwwZlBOWVQ_469767337.Field0 = (0 <= sysFetchbounce__TzJMNLY39cRyxRwwZlBOWVQ_469767337.Field1);
                    if (!((sysProcessed_469763352[3] != undefined))) {
                    sysProcessed_469763352[3] = true;
                    if (sysFetchbounce__TzJMNLY39cRyxRwwZlBOWVQ_469767337.Field0) {
                    del_469767008(sysBounce_469764129[0].index, entity_469766726.Field0);
                    var topIdxHEX60gensym188_469767466 = (sysBounce_469764129[0].groups).length - 1;
                    var riHEX60gensym188_469767467 = sysFetchbounce__TzJMNLY39cRyxRwwZlBOWVQ_469767337.Field1;
                    if ((riHEX60gensym188_469767467 < topIdxHEX60gensym188_469767466)) {
                    Temporary14 = sysBounce_469764129[0].groups[topIdxHEX60gensym188_469767466];
                    sysBounce_469764129[0].groups[topIdxHEX60gensym188_469767466] = genericReset(sysBounce_469764129[0].groups[topIdxHEX60gensym188_469767466], NTI469763398);
                    sysBounce_469764129[0].groups[riHEX60gensym188_469767467] = nimCopy(sysBounce_469764129[0].groups[riHEX60gensym188_469767467], Temporary14, NTI469763398);
                    var updatedRowEnt_469763416 = nimCopy(null, sysBounce_469764129[0].groups[riHEX60gensym188_469767467].entity, NTI1140850875);
                    HEX5BHEX5DHEX3D_469767160(sysBounce_469764129[0].index, updatedRowEnt_469763416.Field0, sysFetchbounce__TzJMNLY39cRyxRwwZlBOWVQ_469767337.Field1);
                    }
                    
                    if (sysBounce_469764129[0].groups.length < (Temporary15 = ((sysBounce_469764129[0].groups).length - 1), Temporary15)) { for (var i = sysBounce_469764129[0].groups.length ; i < Temporary15 ; ++i) sysBounce_469764129[0].groups.push(({entity: {Field0: 0, Field1: 0}, pos: 0, vel: 0, bounce: 0})); }
               else { sysBounce_469764129[0].groups.length = Temporary15; };
                    }
                    
                    }
                    
                    break;
                  case 2:
                    var sysFetchmove__TzJMNLY39cRyxRwwZlBOWVQ_469767563 = {Field0: false, Field1: 0};
                    sysFetchmove__TzJMNLY39cRyxRwwZlBOWVQ_469767563.Field1 = getOrDefault_469766942(sysMove_469763872[0].index, entity_469766726.Field0, -1);
                    sysFetchmove__TzJMNLY39cRyxRwwZlBOWVQ_469767563.Field0 = (0 <= sysFetchmove__TzJMNLY39cRyxRwwZlBOWVQ_469767563.Field1);
                    if (!((sysProcessed_469763352[1] != undefined))) {
                    sysProcessed_469763352[1] = true;
                    if (sysFetchmove__TzJMNLY39cRyxRwwZlBOWVQ_469767563.Field0) {
                    del_469767008(sysMove_469763872[0].index, entity_469766726.Field0);
                    var topIdxHEX60gensym208_469767692 = (sysMove_469763872[0].groups).length - 1;
                    var riHEX60gensym208_469767693 = sysFetchmove__TzJMNLY39cRyxRwwZlBOWVQ_469767563.Field1;
                    if ((riHEX60gensym208_469767693 < topIdxHEX60gensym208_469767692)) {
                    Temporary16 = sysMove_469763872[0].groups[topIdxHEX60gensym208_469767692];
                    sysMove_469763872[0].groups[topIdxHEX60gensym208_469767692] = genericReset(sysMove_469763872[0].groups[topIdxHEX60gensym208_469767692], NTI469763228);
                    sysMove_469763872[0].groups[riHEX60gensym208_469767693] = nimCopy(sysMove_469763872[0].groups[riHEX60gensym208_469767693], Temporary16, NTI469763228);
                    var updatedRowEnt_469763506 = nimCopy(null, sysMove_469763872[0].groups[riHEX60gensym208_469767693].entity, NTI1140850875);
                    HEX5BHEX5DHEX3D_469767160(sysMove_469763872[0].index, updatedRowEnt_469763506.Field0, sysFetchmove__TzJMNLY39cRyxRwwZlBOWVQ_469767563.Field1);
                    }
                    
                    if (sysMove_469763872[0].groups.length < (Temporary17 = ((sysMove_469763872[0].groups).length - 1), Temporary17)) { for (var i = sysMove_469763872[0].groups.length ; i < Temporary17 ; ++i) sysMove_469763872[0].groups.push(({entity: {Field0: 0, Field1: 0}, pos: 0, vel: 0})); }
               else { sysMove_469763872[0].groups.length = Temporary17; };
                    }
                    
                    }
                    
                    var sysFetchgravity__TzJMNLY39cRyxRwwZlBOWVQ_469767775 = {Field0: false, Field1: 0};
                    sysFetchgravity__TzJMNLY39cRyxRwwZlBOWVQ_469767775.Field1 = getOrDefault_469766942(sysGravity_469764039[0].index, entity_469766726.Field0, -1);
                    sysFetchgravity__TzJMNLY39cRyxRwwZlBOWVQ_469767775.Field0 = (0 <= sysFetchgravity__TzJMNLY39cRyxRwwZlBOWVQ_469767775.Field1);
                    if (!((sysProcessed_469763352[2] != undefined))) {
                    sysProcessed_469763352[2] = true;
                    if (sysFetchgravity__TzJMNLY39cRyxRwwZlBOWVQ_469767775.Field0) {
                    del_469767008(sysGravity_469764039[0].index, entity_469766726.Field0);
                    var topIdxHEX60gensym216_469767904 = (sysGravity_469764039[0].groups).length - 1;
                    var riHEX60gensym216_469767905 = sysFetchgravity__TzJMNLY39cRyxRwwZlBOWVQ_469767775.Field1;
                    if ((riHEX60gensym216_469767905 < topIdxHEX60gensym216_469767904)) {
                    Temporary18 = sysGravity_469764039[0].groups[topIdxHEX60gensym216_469767904];
                    sysGravity_469764039[0].groups[topIdxHEX60gensym216_469767904] = genericReset(sysGravity_469764039[0].groups[topIdxHEX60gensym216_469767904], NTI469763346);
                    sysGravity_469764039[0].groups[riHEX60gensym216_469767905] = nimCopy(sysGravity_469764039[0].groups[riHEX60gensym216_469767905], Temporary18, NTI469763346);
                    var updatedRowEnt_469763509 = nimCopy(null, sysGravity_469764039[0].groups[riHEX60gensym216_469767905].entity, NTI1140850875);
                    HEX5BHEX5DHEX3D_469767160(sysGravity_469764039[0].index, updatedRowEnt_469763509.Field0, sysFetchgravity__TzJMNLY39cRyxRwwZlBOWVQ_469767775.Field1);
                    }
                    
                    if (sysGravity_469764039[0].groups.length < (Temporary19 = ((sysGravity_469764039[0].groups).length - 1), Temporary19)) { for (var i = sysGravity_469764039[0].groups.length ; i < Temporary19 ; ++i) sysGravity_469764039[0].groups.push(({entity: {Field0: 0, Field1: 0}, vel: 0, gravity: 0})); }
               else { sysGravity_469764039[0].groups.length = Temporary19; };
                    }
                    
                    }
                    
                    var sysFetchbounce__TzJMNLY39cRyxRwwZlBOWVQ_469768001 = {Field0: false, Field1: 0};
                    sysFetchbounce__TzJMNLY39cRyxRwwZlBOWVQ_469768001.Field1 = getOrDefault_469766942(sysBounce_469764129[0].index, entity_469766726.Field0, -1);
                    sysFetchbounce__TzJMNLY39cRyxRwwZlBOWVQ_469768001.Field0 = (0 <= sysFetchbounce__TzJMNLY39cRyxRwwZlBOWVQ_469768001.Field1);
                    if (!((sysProcessed_469763352[3] != undefined))) {
                    sysProcessed_469763352[3] = true;
                    if (sysFetchbounce__TzJMNLY39cRyxRwwZlBOWVQ_469768001.Field0) {
                    del_469767008(sysBounce_469764129[0].index, entity_469766726.Field0);
                    var topIdxHEX60gensym224_469768130 = (sysBounce_469764129[0].groups).length - 1;
                    var riHEX60gensym224_469768131 = sysFetchbounce__TzJMNLY39cRyxRwwZlBOWVQ_469768001.Field1;
                    if ((riHEX60gensym224_469768131 < topIdxHEX60gensym224_469768130)) {
                    Temporary20 = sysBounce_469764129[0].groups[topIdxHEX60gensym224_469768130];
                    sysBounce_469764129[0].groups[topIdxHEX60gensym224_469768130] = genericReset(sysBounce_469764129[0].groups[topIdxHEX60gensym224_469768130], NTI469763398);
                    sysBounce_469764129[0].groups[riHEX60gensym224_469768131] = nimCopy(sysBounce_469764129[0].groups[riHEX60gensym224_469768131], Temporary20, NTI469763398);
                    var updatedRowEnt_469763512 = nimCopy(null, sysBounce_469764129[0].groups[riHEX60gensym224_469768131].entity, NTI1140850875);
                    HEX5BHEX5DHEX3D_469767160(sysBounce_469764129[0].index, updatedRowEnt_469763512.Field0, sysFetchbounce__TzJMNLY39cRyxRwwZlBOWVQ_469768001.Field1);
                    }
                    
                    if (sysBounce_469764129[0].groups.length < (Temporary21 = ((sysBounce_469764129[0].groups).length - 1), Temporary21)) { for (var i = sysBounce_469764129[0].groups.length ; i < Temporary21 ; ++i) sysBounce_469764129[0].groups.push(({entity: {Field0: 0, Field1: 0}, pos: 0, vel: 0, bounce: 0})); }
               else { sysBounce_469764129[0].groups.length = Temporary21; };
                    }
                    
                    }
                    
                    break;
                  case 3:
                    var sysFetchgravity__TzJMNLY39cRyxRwwZlBOWVQ_469768213 = {Field0: false, Field1: 0};
                    sysFetchgravity__TzJMNLY39cRyxRwwZlBOWVQ_469768213.Field1 = getOrDefault_469766942(sysGravity_469764039[0].index, entity_469766726.Field0, -1);
                    sysFetchgravity__TzJMNLY39cRyxRwwZlBOWVQ_469768213.Field0 = (0 <= sysFetchgravity__TzJMNLY39cRyxRwwZlBOWVQ_469768213.Field1);
                    if (!((sysProcessed_469763352[2] != undefined))) {
                    sysProcessed_469763352[2] = true;
                    if (sysFetchgravity__TzJMNLY39cRyxRwwZlBOWVQ_469768213.Field0) {
                    del_469767008(sysGravity_469764039[0].index, entity_469766726.Field0);
                    var topIdxHEX60gensym249_469768342 = (sysGravity_469764039[0].groups).length - 1;
                    var riHEX60gensym249_469768343 = sysFetchgravity__TzJMNLY39cRyxRwwZlBOWVQ_469768213.Field1;
                    if ((riHEX60gensym249_469768343 < topIdxHEX60gensym249_469768342)) {
                    Temporary22 = sysGravity_469764039[0].groups[topIdxHEX60gensym249_469768342];
                    sysGravity_469764039[0].groups[topIdxHEX60gensym249_469768342] = genericReset(sysGravity_469764039[0].groups[topIdxHEX60gensym249_469768342], NTI469763346);
                    sysGravity_469764039[0].groups[riHEX60gensym249_469768343] = nimCopy(sysGravity_469764039[0].groups[riHEX60gensym249_469768343], Temporary22, NTI469763346);
                    var updatedRowEnt_469763515 = nimCopy(null, sysGravity_469764039[0].groups[riHEX60gensym249_469768343].entity, NTI1140850875);
                    HEX5BHEX5DHEX3D_469767160(sysGravity_469764039[0].index, updatedRowEnt_469763515.Field0, sysFetchgravity__TzJMNLY39cRyxRwwZlBOWVQ_469768213.Field1);
                    }
                    
                    if (sysGravity_469764039[0].groups.length < (Temporary23 = ((sysGravity_469764039[0].groups).length - 1), Temporary23)) { for (var i = sysGravity_469764039[0].groups.length ; i < Temporary23 ; ++i) sysGravity_469764039[0].groups.push(({entity: {Field0: 0, Field1: 0}, vel: 0, gravity: 0})); }
               else { sysGravity_469764039[0].groups.length = Temporary23; };
                    }
                    
                    }
                    
                    break;
                  case 4:
                    var sysFetchbounce__TzJMNLY39cRyxRwwZlBOWVQ_469768425 = {Field0: false, Field1: 0};
                    sysFetchbounce__TzJMNLY39cRyxRwwZlBOWVQ_469768425.Field1 = getOrDefault_469766942(sysBounce_469764129[0].index, entity_469766726.Field0, -1);
                    sysFetchbounce__TzJMNLY39cRyxRwwZlBOWVQ_469768425.Field0 = (0 <= sysFetchbounce__TzJMNLY39cRyxRwwZlBOWVQ_469768425.Field1);
                    if (!((sysProcessed_469763352[3] != undefined))) {
                    sysProcessed_469763352[3] = true;
                    if (sysFetchbounce__TzJMNLY39cRyxRwwZlBOWVQ_469768425.Field0) {
                    del_469767008(sysBounce_469764129[0].index, entity_469766726.Field0);
                    var topIdxHEX60gensym263_469768554 = (sysBounce_469764129[0].groups).length - 1;
                    var riHEX60gensym263_469768555 = sysFetchbounce__TzJMNLY39cRyxRwwZlBOWVQ_469768425.Field1;
                    if ((riHEX60gensym263_469768555 < topIdxHEX60gensym263_469768554)) {
                    Temporary24 = sysBounce_469764129[0].groups[topIdxHEX60gensym263_469768554];
                    sysBounce_469764129[0].groups[topIdxHEX60gensym263_469768554] = genericReset(sysBounce_469764129[0].groups[topIdxHEX60gensym263_469768554], NTI469763398);
                    sysBounce_469764129[0].groups[riHEX60gensym263_469768555] = nimCopy(sysBounce_469764129[0].groups[riHEX60gensym263_469768555], Temporary24, NTI469763398);
                    var updatedRowEnt_469763518 = nimCopy(null, sysBounce_469764129[0].groups[riHEX60gensym263_469768555].entity, NTI1140850875);
                    HEX5BHEX5DHEX3D_469767160(sysBounce_469764129[0].index, updatedRowEnt_469763518.Field0, sysFetchbounce__TzJMNLY39cRyxRwwZlBOWVQ_469768425.Field1);
                    }
                    
                    if (sysBounce_469764129[0].groups.length < (Temporary25 = ((sysBounce_469764129[0].groups).length - 1), Temporary25)) { for (var i = sysBounce_469764129[0].groups.length ; i < Temporary25 ; ++i) sysBounce_469764129[0].groups.push(({entity: {Field0: 0, Field1: 0}, pos: 0, vel: 0, bounce: 0})); }
               else { sysBounce_469764129[0].groups.length = Temporary25; };
                    }
                    
                    }
                    
                    break;
                  default: 
                    break;
                  }
                  i_469780116 += 1;
                }
            } while (false);
          } while (false);
        } while (false);
      } while (false);
    } while (false);
    Label26: do {
      var compRefHEX60gensym277_469768640 = null;
      var colontmp__469780120 = [];
      colontmp__469780120 = entityStorage_469765280[0].entityComponents[entityId_469766839].componentRefs;
      var i_469780121 = 0;
      var L_469780122 = (colontmp__469780120).length;
      Label27: do {
          Label28: while (true) {
          if (!(i_469780121 < L_469780122)) break Label28;
            compRefHEX60gensym277_469768640 = colontmp__469780120[i_469780121];
            switch (((compRefHEX60gensym277_469768640.Field0) | 0)) {
            case 1:
              delete_469764363(compRefHEX60gensym277_469768640.Field1);
              break;
            case 2:
              delete_469764599(compRefHEX60gensym277_469768640.Field1);
              break;
            case 3:
              delete_469764834(compRefHEX60gensym277_469768640.Field1);
              break;
            case 4:
              delete_469765069(compRefHEX60gensym277_469768640.Field1);
              break;
            default: 
              break;
            }
            i_469780121 += 1;
          }
      } while (false);
    } while (false);
    if (entityStorage_469765280[0].entityComponents[entityId_469766839].componentRefs.length < 0) { for (var i = entityStorage_469765280[0].entityComponents[entityId_469766839].componentRefs.length ; i < 0 ; ++i) entityStorage_469765280[0].entityComponents[entityId_469766839].componentRefs.push({Field0: 0, Field1: 0, Field2: 0}); }
               else { entityStorage_469765280[0].entityComponents[entityId_469766839].componentRefs.length = 0; };
    entityStorage_469765280[0].entityComponents[entityId_469766839].setup = false;
    entityStorage_469765280[0].entityCounter -= 1;
    entityStorage_469765280[0].entityRecycler.push(entityId_469766839);;
    if ((entityStorage_469765280[0].entityCounter == 0)) {
    if (entityStorage_469765280[0].entityRecycler.length < 0) { for (var i = entityStorage_469765280[0].entityRecycler.length ; i < 0 ; ++i) entityStorage_469765280[0].entityRecycler.push(0); }
               else { entityStorage_469765280[0].entityRecycler.length = 0; };
    entityStorage_469765280[0].nextEntityId = 1;
    }
    
  } while (false);

  
}

function doMove_469779428(sys_469779429) {
    if (!(sys_469779429.disabled)) {
    if (!(sys_469779429.paused)) {
    Label1: do {
      var sysLen_469779449 = (sys_469779429.groups).length;
      if ((0 < sysLen_469779449)) {
      var i_469779386 = 0;
      Label2: do {
          Label3: while (true) {
          if (!(i_469779386 < sysLen_469779449)) break Label3;
            var entity_469779450 = nimCopy(null, sys_469779429.groups[i_469779386].entity, NTI1140850875);
            var groupIndex_469779452 = i_469779386;
            rawEcho(makeNimstrLit("move"));
            HEX2BHEX3D_872417266(storagePos_469764205[0][sys_469779429.groups[groupIndex_469779452].pos].x, storageVel_469764210[0][sys_469779429.groups[groupIndex_469779452].vel].x);
            HEX2BHEX3D_872417266(storagePos_469764205[0][sys_469779429.groups[groupIndex_469779452].pos].y, storageVel_469764210[0][sys_469779429.groups[groupIndex_469779452].vel].y);
            i_469779386 = (i_469779386 + 1);
          }
      } while (false);
      }
      
    } while (false);
    }
    
    Label4: do {
      var iHEX60gensym1503_469779479 = 0;
      var colontmp__469780091 = 0;
      colontmp__469780091 = (sys_469779429.deleteList).length;
      var i_469780092 = 0;
      Label5: do {
          Label6: while (true) {
          if (!(i_469780092 < colontmp__469780091)) break Label6;
            iHEX60gensym1503_469779479 = i_469780092;
            doDelete_469766725(sys_469779429.deleteList[iHEX60gensym1503_469779479]);
            i_469780092 += 1;
          }
      } while (false);
    } while (false);
    if (sys_469779429.deleteList.length < 0) { for (var i = sys_469779429.deleteList.length ; i < 0 ; ++i) sys_469779429.deleteList.push({Field0: 0, Field1: 0}); }
               else { sys_469779429.deleteList.length = 0; };
    }
    

  
}

function HEX2DHEX3D_469779517(x_469779519, x_469779519_Idx, y_469779520) {
    x_469779519[x_469779519_Idx] = (x_469779519[x_469779519_Idx] - y_469779520);

  
}

function doGravity_469779485(sys_469779486) {
    if (!(sys_469779486.disabled)) {
    if (!(sys_469779486.paused)) {
    Label1: do {
      var sysLen_469779504 = (sys_469779486.groups).length;
      if ((0 < sysLen_469779504)) {
      var i_469779415 = 0;
      Label2: do {
          Label3: while (true) {
          if (!(i_469779415 < sysLen_469779504)) break Label3;
            var entity_469779505 = nimCopy(null, sys_469779486.groups[i_469779415].entity, NTI1140850875);
            var groupIndex_469779507 = i_469779415;
            HEX2DHEX3D_469779517(storageVel_469764210[0][sys_469779486.groups[groupIndex_469779507].vel].y, storageGravity_469764215[0][sys_469779486.groups[groupIndex_469779507].gravity].strength);
            i_469779415 = (i_469779415 + 1);
          }
      } while (false);
      }
      
    } while (false);
    }
    
    Label4: do {
      var iHEX60gensym1528_469779528 = 0;
      var colontmp__469780129 = 0;
      colontmp__469780129 = (sys_469779486.deleteList).length;
      var i_469780130 = 0;
      Label5: do {
          Label6: while (true) {
          if (!(i_469780130 < colontmp__469780129)) break Label6;
            iHEX60gensym1528_469779528 = i_469780130;
            doDelete_469766725(sys_469779486.deleteList[iHEX60gensym1528_469779528]);
            i_469780130 += 1;
          }
      } while (false);
    } while (false);
    if (sys_469779486.deleteList.length < 0) { for (var i = sys_469779486.deleteList.length ; i < 0 ; ++i) sys_469779486.deleteList.push({Field0: 0, Field1: 0}); }
               else { sys_469779486.deleteList.length = 0; };
    }
    

  
}

function abs_738197646(x_738197648) {
  var result_738197649 = 0.0;

    result_738197649 = Math.abs(x_738197648);

  return result_738197649;

}

function doBounce_469779534(sys_469779535) {
    if (!(sys_469779535.disabled)) {
    if (!(sys_469779535.paused)) {
    Label1: do {
      var sysLen_469779553 = (sys_469779535.groups).length;
      if ((0 < sysLen_469779553)) {
      var i_469779421 = 0;
      Label2: do {
          Label3: while (true) {
          if (!(i_469779421 < sysLen_469779553)) break Label3;
            var entity_469779554 = nimCopy(null, sys_469779535.groups[i_469779421].entity, NTI1140850875);
            var groupIndex_469779556 = i_469779421;
            if ((storagePos_469764205[0][sys_469779535.groups[groupIndex_469779556].pos].y <= 0.0)) {
            storagePos_469764205[0][sys_469779535.groups[groupIndex_469779556].pos].y = 0.0;
            storageVel_469764210[0][sys_469779535.groups[groupIndex_469779556].vel].y = (abs_738197646(storageVel_469764210[0][sys_469779535.groups[groupIndex_469779556].vel].y) * 0.5);
            }
            
            i_469779421 = (i_469779421 + 1);
          }
      } while (false);
      }
      
    } while (false);
    }
    
    Label4: do {
      var iHEX60gensym1557_469779580 = 0;
      var colontmp__469780135 = 0;
      colontmp__469780135 = (sys_469779535.deleteList).length;
      var i_469780136 = 0;
      Label5: do {
          Label6: while (true) {
          if (!(i_469780136 < colontmp__469780135)) break Label6;
            iHEX60gensym1557_469779580 = i_469780136;
            doDelete_469766725(sys_469779535.deleteList[iHEX60gensym1557_469779580]);
            i_469780136 += 1;
          }
      } while (false);
    } while (false);
    if (sys_469779535.deleteList.length < 0) { for (var i = sys_469779535.deleteList.length ; i < 0 ; ++i) sys_469779535.deleteList.push({Field0: 0, Field1: 0}); }
               else { sys_469779535.deleteList.length = 0; };
    }
    

  
}

function run_469779586() {
    doMove_469779428(sysMove_469763872[0]);
    doGravity_469779485(sysGravity_469764039[0]);
    doBounce_469779534(sysBounce_469764129[0]);

  
}

function componentCount_469765462(entityId_469765463) {
  var result_469765464 = 0;

    result_469765464 = (entityStorage_469765280[0].entityComponents[entityId_469765463].componentRefs).length;

  return result_469765464;

}

function componentCount_469765468(entityRefHEX60gensym128_469765469) {
  var result_469765470 = 0;

    result_469765470 = componentCount_469765462(entityRefHEX60gensym128_469765469.Field0);

  return result_469765470;

}

function addChars_251658415(result_251658417, result_251658417_Idx, x_251658418, start_251658419, n_251658420) {
    var old_251658421 = (result_251658417[result_251658417_Idx]).length;
    (result_251658417[result_251658417_Idx].length = (old_251658421 + n_251658420));
    Label1: do {
      var iHEX60gensym4_251658435 = 0;
      var i_469780142 = 0;
      Label2: do {
          Label3: while (true) {
          if (!(i_469780142 < n_251658420)) break Label3;
            iHEX60gensym4_251658435 = i_469780142;
            result_251658417[result_251658417_Idx][(old_251658421 + iHEX60gensym4_251658435)] = x_251658418.charCodeAt((start_251658419 + iHEX60gensym4_251658435));
            i_469780142 += 1;
          }
      } while (false);
    } while (false);

  
}

function addChars_251658411(result_251658413, result_251658413_Idx, x_251658414) {
    addChars_251658415(result_251658413, result_251658413_Idx, x_251658414, 0, ((x_251658414) == null ? 0 : (x_251658414).length));

  
}

function addInt_251658436(result_251658437, result_251658437_Idx, x_251658438) {
    addChars_251658411(result_251658437, result_251658437_Idx, ((x_251658438) + ""));

  
}

function addInt_251658457(result_251658458, result_251658458_Idx, x_251658459) {
    addInt_251658436(result_251658458, result_251658458_Idx, x_251658459);

  
}

function HEX24_318767107(x_318767108) {
  var result_318767109 = [[]];

    addInt_251658457(result_318767109, 0, x_318767108);

  return result_318767109[0];

}

function add_33556420(x_33556421, x_33556421_Idx, y_33556422) {
          if (x_33556421[x_33556421_Idx] === null) { x_33556421[x_33556421_Idx] = []; }
      var off = x_33556421[x_33556421_Idx].length;
      x_33556421[x_33556421_Idx].length += y_33556422.length;
      for (var i = 0; i < y_33556422.length; ++i) {
        x_33556421[x_33556421_Idx][off+i] = y_33556422.charCodeAt(i);
      }
    

  
}

function nimFloatToString_335544446(a_335544447) {
  var result_335544448 = null;

        function nimOnlyDigitsOrMinus(n) {
      return n.toString().match(/^-?\d+$/);
    }
    if (Number.isSafeInteger(a_335544447))
      result_335544448 = a_335544447 === 0 && 1 / a_335544447 < 0 ? "-0.0" : a_335544447+".0"
    else {
      result_335544448 = a_335544447+""
      if(nimOnlyDigitsOrMinus(result_335544448)){
        result_335544448 = a_335544447+".0"
      }
    }
  

  return result_335544448;

}

function addFloat_33557373(result_33557375, result_33557375_Idx, x_33557376) {
    add_33556420(result_33557375, result_33557375_Idx, nimFloatToString_335544446(x_33557376));

  
}

function addQuoted_469765729(s_469765731, s_469765731_Idx, x_469765732) {
    addFloat_33557373(s_469765731, s_469765731_Idx, x_469765732);

  
}

function HEX24_469765706(x_469765708) {
  var result_469765709 = [[]];

    result_469765709[0] = nimCopy(null, makeNimstrLit("("), NTI33554439);
    var count_469765715 = 0;
    if ((0 < count_469765715)) {
    result_469765709[0].push.apply(result_469765709[0], makeNimstrLit(", "));;
    }
    
    result_469765709[0].push.apply(result_469765709[0], makeNimstrLit("x"));;
    result_469765709[0].push.apply(result_469765709[0], makeNimstrLit(": "));;
    count_469765715 += 1;
    addQuoted_469765729(result_469765709, 0, x_469765708.x);
    if ((0 < count_469765715)) {
    result_469765709[0].push.apply(result_469765709[0], makeNimstrLit(", "));;
    }
    
    result_469765709[0].push.apply(result_469765709[0], makeNimstrLit("y"));;
    result_469765709[0].push.apply(result_469765709[0], makeNimstrLit(": "));;
    count_469765715 += 1;
    addQuoted_469765729(result_469765709, 0, x_469765708.y);
    result_469765709[0].push.apply(result_469765709[0], makeNimstrLit(")"));;

  return result_469765709[0];

}

function HEX24_469765774(x_469765776) {
  var result_469765777 = [[]];

    result_469765777[0] = nimCopy(null, makeNimstrLit("("), NTI33554439);
    var count_469765783 = 0;
    if ((0 < count_469765783)) {
    result_469765777[0].push.apply(result_469765777[0], makeNimstrLit(", "));;
    }
    
    result_469765777[0].push.apply(result_469765777[0], makeNimstrLit("x"));;
    result_469765777[0].push.apply(result_469765777[0], makeNimstrLit(": "));;
    count_469765783 += 1;
    addQuoted_469765729(result_469765777, 0, x_469765776.x);
    if ((0 < count_469765783)) {
    result_469765777[0].push.apply(result_469765777[0], makeNimstrLit(", "));;
    }
    
    result_469765777[0].push.apply(result_469765777[0], makeNimstrLit("y"));;
    result_469765777[0].push.apply(result_469765777[0], makeNimstrLit(": "));;
    count_469765783 += 1;
    addQuoted_469765729(result_469765777, 0, x_469765776.y);
    result_469765777[0].push.apply(result_469765777[0], makeNimstrLit(")"));;

  return result_469765777[0];

}

function HEX24_469765836(x_469765838) {
  var result_469765839 = [[]];

    result_469765839[0] = nimCopy(null, makeNimstrLit("("), NTI33554439);
    var count_469765845 = 0;
    if ((0 < count_469765845)) {
    result_469765839[0].push.apply(result_469765839[0], makeNimstrLit(", "));;
    }
    
    result_469765839[0].push.apply(result_469765839[0], makeNimstrLit("strength"));;
    result_469765839[0].push.apply(result_469765839[0], makeNimstrLit(": "));;
    count_469765845 += 1;
    addQuoted_469765729(result_469765839, 0, x_469765838.strength);
    result_469765839[0].push.apply(result_469765839[0], makeNimstrLit(")"));;

  return result_469765839[0];

}

function HEX24_469765884(x_469765886) {
  var result_469765887 = [];

    result_469765887 = nimCopy(null, makeNimstrLit("("), NTI33554439);
    var count_469765893 = 0;
    result_469765887.push.apply(result_469765887, makeNimstrLit(")"));;

  return result_469765887;

}

function toString_469765685(componentRefHEX60gensym153_469765686, showData_469765687) {
      var Temporary2;
      var Temporary4;
      var Temporary6;
      var Temporary8;

  var result_469765688 = [];

    var tIdHEX60gensym153_469765689 = componentRefHEX60gensym153_469765686.Field0;
    switch (((tIdHEX60gensym153_469765689) | 0)) {
    case 1:
      result_469765688 = nimCopy(null, (makeNimstrLit("Pos (id: ") || []).concat(HEX24_318767107(((tIdHEX60gensym153_469765689) | 0)) || [],makeNimstrLit(", index: ") || [],HEX24_318767107(((componentRefHEX60gensym153_469765686.Field1) | 0)) || [],makeNimstrLit(", generation: ") || [],HEX24_318767107(((componentRefHEX60gensym153_469765686.Field2) | 0)) || [],makeNimstrLit(")") || []), NTI33554439);
      if (showData_469765687) {
      result_469765688.push.apply(result_469765688, makeNimstrLit(": "));;
++excHandler;
      Temporary2 = framePtr;
      try {
      result_469765688.push.apply(result_469765688, HEX24_469765706(storagePos_469764205[0][((((componentRefHEX60gensym153_469765686.Field1) | 0)) | 0)]));;
--excHandler;
} catch (EXCEPTION) {
 var prevJSError = lastJSError;
 lastJSError = EXCEPTION;
 --excHandler;
      framePtr = Temporary2;
      var freeCountHEX60gensym68HEX60gensym764_469765758 = (posFreeIndexes_469764206[0]).length;
      result_469765688.push.apply(result_469765688, (makeNimstrLit("<ERROR ACCESSING (index: ") || []).concat(HEX24_318767107(((componentRefHEX60gensym153_469765686.Field1) | 0)) || [],makeNimstrLit(", count: ") || [],HEX24_318767107((((storagePos_469764205[0]).length - 1) - freeCountHEX60gensym68HEX60gensym764_469765758)) || [],makeNimstrLit(")>\x0A") || []));;
      lastJSError = prevJSError;
      } finally {
      framePtr = Temporary2;
      }
      }
      
      break;
    case 2:
      result_469765688 = nimCopy(null, (makeNimstrLit("Vel (id: ") || []).concat(HEX24_318767107(((tIdHEX60gensym153_469765689) | 0)) || [],makeNimstrLit(", index: ") || [],HEX24_318767107(((componentRefHEX60gensym153_469765686.Field1) | 0)) || [],makeNimstrLit(", generation: ") || [],HEX24_318767107(((componentRefHEX60gensym153_469765686.Field2) | 0)) || [],makeNimstrLit(")") || []), NTI33554439);
      if (showData_469765687) {
      result_469765688.push.apply(result_469765688, makeNimstrLit(": "));;
++excHandler;
      Temporary4 = framePtr;
      try {
      result_469765688.push.apply(result_469765688, HEX24_469765774(storageVel_469764210[0][((((componentRefHEX60gensym153_469765686.Field1) | 0)) | 0)]));;
--excHandler;
} catch (EXCEPTION) {
 var prevJSError = lastJSError;
 lastJSError = EXCEPTION;
 --excHandler;
      framePtr = Temporary4;
      var freeCountHEX60gensym82HEX60gensym769_469765820 = (velFreeIndexes_469764211[0]).length;
      result_469765688.push.apply(result_469765688, (makeNimstrLit("<ERROR ACCESSING (index: ") || []).concat(HEX24_318767107(((componentRefHEX60gensym153_469765686.Field1) | 0)) || [],makeNimstrLit(", count: ") || [],HEX24_318767107((((storageVel_469764210[0]).length - 1) - freeCountHEX60gensym82HEX60gensym769_469765820)) || [],makeNimstrLit(")>\x0A") || []));;
      lastJSError = prevJSError;
      } finally {
      framePtr = Temporary4;
      }
      }
      
      break;
    case 3:
      result_469765688 = nimCopy(null, (makeNimstrLit("Gravity (id: ") || []).concat(HEX24_318767107(((tIdHEX60gensym153_469765689) | 0)) || [],makeNimstrLit(", index: ") || [],HEX24_318767107(((componentRefHEX60gensym153_469765686.Field1) | 0)) || [],makeNimstrLit(", generation: ") || [],HEX24_318767107(((componentRefHEX60gensym153_469765686.Field2) | 0)) || [],makeNimstrLit(")") || []), NTI33554439);
      if (showData_469765687) {
      result_469765688.push.apply(result_469765688, makeNimstrLit(": "));;
++excHandler;
      Temporary6 = framePtr;
      try {
      result_469765688.push.apply(result_469765688, HEX24_469765836(storageGravity_469764215[0][((((componentRefHEX60gensym153_469765686.Field1) | 0)) | 0)]));;
--excHandler;
} catch (EXCEPTION) {
 var prevJSError = lastJSError;
 lastJSError = EXCEPTION;
 --excHandler;
      framePtr = Temporary6;
      var freeCountHEX60gensym96HEX60gensym774_469765868 = (gravityFreeIndexes_469764216[0]).length;
      result_469765688.push.apply(result_469765688, (makeNimstrLit("<ERROR ACCESSING (index: ") || []).concat(HEX24_318767107(((componentRefHEX60gensym153_469765686.Field1) | 0)) || [],makeNimstrLit(", count: ") || [],HEX24_318767107((((storageGravity_469764215[0]).length - 1) - freeCountHEX60gensym96HEX60gensym774_469765868)) || [],makeNimstrLit(")>\x0A") || []));;
      lastJSError = prevJSError;
      } finally {
      framePtr = Temporary6;
      }
      }
      
      break;
    case 4:
      result_469765688 = nimCopy(null, (makeNimstrLit("Bounce (id: ") || []).concat(HEX24_318767107(((tIdHEX60gensym153_469765689) | 0)) || [],makeNimstrLit(", index: ") || [],HEX24_318767107(((componentRefHEX60gensym153_469765686.Field1) | 0)) || [],makeNimstrLit(", generation: ") || [],HEX24_318767107(((componentRefHEX60gensym153_469765686.Field2) | 0)) || [],makeNimstrLit(")") || []), NTI33554439);
      if (showData_469765687) {
      result_469765688.push.apply(result_469765688, makeNimstrLit(": "));;
++excHandler;
      Temporary8 = framePtr;
      try {
      result_469765688.push.apply(result_469765688, HEX24_469765884(storageBounce_469764220[0][((((componentRefHEX60gensym153_469765686.Field1) | 0)) | 0)]));;
--excHandler;
} catch (EXCEPTION) {
 var prevJSError = lastJSError;
 lastJSError = EXCEPTION;
 --excHandler;
      framePtr = Temporary8;
      var freeCountHEX60gensym110HEX60gensym779_469765902 = (bounceFreeIndexes_469764221[0]).length;
      result_469765688.push.apply(result_469765688, (makeNimstrLit("<ERROR ACCESSING (index: ") || []).concat(HEX24_318767107(((componentRefHEX60gensym153_469765686.Field1) | 0)) || [],makeNimstrLit(", count: ") || [],HEX24_318767107((((storageBounce_469764220[0]).length - 1) - freeCountHEX60gensym110HEX60gensym779_469765902)) || [],makeNimstrLit(")>\x0A") || []));;
      lastJSError = prevJSError;
      } finally {
      framePtr = Temporary8;
      }
      }
      
      break;
    default: 
      break;
    }

  return result_469765688;

}

function HEX24_469765555(componentIdHEX60gensym153_469765556) {
  var result_469765557 = [];

    switch (((componentIdHEX60gensym153_469765556) | 0)) {
    case 1:
      result_469765557 = nimCopy(null, (makeNimstrLit("Pos (") || []).concat(HEX24_318767107(((componentIdHEX60gensym153_469765556) | 0)) || [],makeNimstrLit(")") || []), NTI33554439);
      break;
    case 2:
      result_469765557 = nimCopy(null, (makeNimstrLit("Vel (") || []).concat(HEX24_318767107(((componentIdHEX60gensym153_469765556) | 0)) || [],makeNimstrLit(")") || []), NTI33554439);
      break;
    case 3:
      result_469765557 = nimCopy(null, (makeNimstrLit("Gravity (") || []).concat(HEX24_318767107(((componentIdHEX60gensym153_469765556) | 0)) || [],makeNimstrLit(")") || []), NTI33554439);
      break;
    case 4:
      result_469765557 = nimCopy(null, (makeNimstrLit("Bounce (") || []).concat(HEX24_318767107(((componentIdHEX60gensym153_469765556) | 0)) || [],makeNimstrLit(")") || []), NTI33554439);
      break;
    default: 
      break;
    }

  return result_469765557;

}

function HEX3DHEX3D_1140851203(c1_1140851204, c2_1140851205) {
  var result_1140851206 = false;

    result_1140851206 = (((c1_1140851204) | 0) == ((c2_1140851205) | 0));

  return result_1140851206;

}

function valid_1174405161(compRef_1174405162) {
    var Temporary1;

  var result_1174405163 = false;

    if (!!(HEX3DHEX3D_1140851203(compRef_1174405162.Field0, 0))) Temporary1 = false; else {      Temporary1 = !((((compRef_1174405162.Field2) | 0) == 0));    }    result_1174405163 = Temporary1;

  return result_1174405163;

}

function listComponents_469766360(entityHEX60gensym165_469766361, showDataHEX60gensym165_469766362) {
      var Temporary1;
      var Temporary2;
      var Temporary3;
      var Temporary4;
              var Temporary10;
                  var Temporary11;
                  var Temporary12;
                  var Temporary13;
                  var Temporary14;

  var result_469766363 = [];

      if (!!(HEX3DHEX3D_1140851215(entityHEX60gensym165_469766361.Field0, 0))) Temporary4 = false; else {        Temporary4 = (1 <= ((entityHEX60gensym165_469766361.Field0) | 0));      }      if (!Temporary4) Temporary3 = false; else {        Temporary3 = (((entityHEX60gensym165_469766361.Field0) | 0) <= (entityStorage_469765280[0].entityComponents).length);      }      if (!Temporary3) Temporary2 = false; else {        Temporary2 = entityStorage_469765280[0].entityComponents[entityHEX60gensym165_469766361.Field0].setup;      }      if (!Temporary2) Temporary1 = false; else {        Temporary1 = (((entityStorage_469765280[0].entityComponents[entityHEX60gensym165_469766361.Field0].instance) | 0) == ((entityHEX60gensym165_469766361.Field1) | 0));      }    if (Temporary1) {
    var entityIdHEX60gensym165_469766367 = entityHEX60gensym165_469766361.Field0;
    if ((0 < componentCount_469765468(entityHEX60gensym165_469766361))) {
    Label5: do {
      var compRefHEX60gensym165_469766368 = {Field0: 0, Field1: 0, Field2: 0};
      Label6: do {
        var itemHEX60gensym127_469780146 = null;
        var colontmp__469780147 = [];
        colontmp__469780147 = entityStorage_469765280[0].entityComponents[entityIdHEX60gensym165_469766367].componentRefs;
        var i_469780148 = 0;
        var L_469780149 = (colontmp__469780147).length;
        Label7: do {
            Label8: while (true) {
            if (!(i_469780148 < L_469780149)) break Label8;
              itemHEX60gensym127_469780146 = colontmp__469780147[i_469780148];
              compRefHEX60gensym165_469766368 = nimCopy(compRefHEX60gensym165_469766368, itemHEX60gensym127_469780146, NTI1140850884);
              var compDescHEX60gensym165_469766369 = toString_469765685(compRefHEX60gensym165_469766368, showDataHEX60gensym165_469766362);
              var ownedHEX60gensym165_469766370 = false;
              var genMaxHEX60gensym165_469766371 = 0;
              var genStrHEX60gensym165_469766372 = [];
++excHandler;
              Temporary10 = framePtr;
              try {
              switch (((compRefHEX60gensym165_469766368.Field0) | 0)) {
              case 1:
                genMaxHEX60gensym165_469766371 = (posInstanceIds_469764209[0]).length;
                var genHEX60gensym165_469766393 = posInstanceIds_469764209[0][compRefHEX60gensym165_469766368.Field1];
                genStrHEX60gensym165_469766372 = nimCopy(null, HEX24_318767107(((genHEX60gensym165_469766393) | 0)), NTI33554439);
                ownedHEX60gensym165_469766370 = false;
                break;
              case 2:
                genMaxHEX60gensym165_469766371 = (velInstanceIds_469764214[0]).length;
                var genHEX60gensym165_469766410 = velInstanceIds_469764214[0][compRefHEX60gensym165_469766368.Field1];
                genStrHEX60gensym165_469766372 = nimCopy(null, HEX24_318767107(((genHEX60gensym165_469766410) | 0)), NTI33554439);
                ownedHEX60gensym165_469766370 = false;
                break;
              case 3:
                genMaxHEX60gensym165_469766371 = (gravityInstanceIds_469764219[0]).length;
                var genHEX60gensym165_469766427 = gravityInstanceIds_469764219[0][compRefHEX60gensym165_469766368.Field1];
                genStrHEX60gensym165_469766372 = nimCopy(null, HEX24_318767107(((genHEX60gensym165_469766427) | 0)), NTI33554439);
                ownedHEX60gensym165_469766370 = false;
                break;
              case 4:
                genMaxHEX60gensym165_469766371 = (bounceInstanceIds_469764224[0]).length;
                var genHEX60gensym165_469766444 = bounceInstanceIds_469764224[0][compRefHEX60gensym165_469766368.Field1];
                genStrHEX60gensym165_469766372 = nimCopy(null, HEX24_318767107(((genHEX60gensym165_469766444) | 0)), NTI33554439);
                ownedHEX60gensym165_469766370 = false;
                break;
              default: 
                break;
              }
--excHandler;
} catch (EXCEPTION) {
 var prevJSError = lastJSError;
 lastJSError = EXCEPTION;
 --excHandler;
              framePtr = Temporary10;
              genStrHEX60gensym165_469766372 = nimCopy(null, (makeNimstrLit(" ERROR ACCESSING generations (index: ") || []).concat(HEX24_318767107(((compRefHEX60gensym165_469766368.Field1) | 0)) || [],makeNimstrLit(", count: ") || [],HEX24_318767107(genMaxHEX60gensym165_469766371) || [],makeNimstrLit(")") || []), NTI33554439);
              lastJSError = prevJSError;
              } finally {
              framePtr = Temporary10;
              }
              if (ownedHEX60gensym165_469766370) {
                var indexHEX60gensym133HEX60gensym837_469766451 = ((compRefHEX60gensym165_469766368.Field1) | 0);
                var rHEX60gensym133HEX60gensym837_469766452 = false;
                switch (((compRefHEX60gensym165_469766368.Field0) | 0)) {
                case 1:
                  if (!posAlive_469764208[0][indexHEX60gensym133HEX60gensym837_469766451]) Temporary11 = false; else {                    Temporary11 = (((compRefHEX60gensym165_469766368.Field2) | 0) == ((posInstanceIds_469764209[0][indexHEX60gensym133HEX60gensym837_469766451]) | 0));                  }                  rHEX60gensym133HEX60gensym837_469766452 = Temporary11;
                  break;
                case 2:
                  if (!velAlive_469764213[0][indexHEX60gensym133HEX60gensym837_469766451]) Temporary12 = false; else {                    Temporary12 = (((compRefHEX60gensym165_469766368.Field2) | 0) == ((velInstanceIds_469764214[0][indexHEX60gensym133HEX60gensym837_469766451]) | 0));                  }                  rHEX60gensym133HEX60gensym837_469766452 = Temporary12;
                  break;
                case 3:
                  if (!gravityAlive_469764218[0][indexHEX60gensym133HEX60gensym837_469766451]) Temporary13 = false; else {                    Temporary13 = (((compRefHEX60gensym165_469766368.Field2) | 0) == ((gravityInstanceIds_469764219[0][indexHEX60gensym133HEX60gensym837_469766451]) | 0));                  }                  rHEX60gensym133HEX60gensym837_469766452 = Temporary13;
                  break;
                case 4:
                  if (!bounceAlive_469764223[0][indexHEX60gensym133HEX60gensym837_469766451]) Temporary14 = false; else {                    Temporary14 = (((compRefHEX60gensym165_469766368.Field2) | 0) == ((bounceInstanceIds_469764224[0][indexHEX60gensym133HEX60gensym837_469766451]) | 0));                  }                  rHEX60gensym133HEX60gensym837_469766452 = Temporary14;
                  break;
                default: 
                  break;
                }
              if (!(rHEX60gensym133HEX60gensym837_469766452)) {
              compDescHEX60gensym165_469766369.push.apply(compDescHEX60gensym165_469766369, (makeNimstrLit(" <DEAD OWNED COMPONENT Type: ") || []).concat(HEX24_469765555(compRefHEX60gensym165_469766368.Field0) || [],makeNimstrLit(", generation: ") || [],genStrHEX60gensym165_469766372 || [],makeNimstrLit(">\x0A") || []));;
              }
              
              }
              else {
                if (!(valid_1174405161(compRefHEX60gensym165_469766368))) {
                compDescHEX60gensym165_469766369.push.apply(compDescHEX60gensym165_469766369, (makeNimstrLit(" <INVALID COMPONENT Type: ") || []).concat(HEX24_469765555(compRefHEX60gensym165_469766368.Field0) || [],makeNimstrLit(", generation: ") || [],genStrHEX60gensym165_469766372 || [],makeNimstrLit(">\x0A") || []));;
                }
                
              }
              
              result_469766363.push.apply(result_469766363, (compDescHEX60gensym165_469766369 || []).concat(makeNimstrLit("\x0A") || []));;
              i_469780148 += 1;
            }
        } while (false);
      } while (false);
    } while (false);
    }
    
    }
    

  return result_469766363;

}

function substr_33557907(s_33557908, first_33557909, last_33557910) {
  var result_33557911 = [];

    var first_33557912 = nimMax(first_33557909, 0);
    var L_33557913 = nimMax(((nimMin(last_33557910, (s_33557908).length - 1) - first_33557912) + 1), 0);
    result_33557911 = nimCopy(null, mnewString(L_33557913), NTI33554439);
    Label1: do {
      var i_33557918 = 0;
      var colontmp__469762358 = 0;
      colontmp__469762358 = (L_33557913 - 1);
      var res_469762359 = 0;
      Label2: do {
          Label3: while (true) {
          if (!(res_469762359 <= colontmp__469762358)) break Label3;
            i_33557918 = res_469762359;
            result_33557911[i_33557918] = s_33557908[(i_33557918 + first_33557912)];
            res_469762359 += 1;
          }
      } while (false);
    } while (false);

  return result_33557911;

}

function nsuIndent(s_872416347, count_872416348, padding_872416349) {
            var Temporary6;

  var result_872416350 = [];

    result_872416350 = nimCopy(null, [], NTI33554439);
    var i_872416351 = 0;
    Label1: do {
      var line_872416352 = [];
      var first_469780158 = 0;
      var last_469780159 = 0;
      var eolpos_469780160 = 0;
      Label2: do {
          Label3: while (true) {
          if (!true) break Label3;
            Label4: do {
                Label5: while (true) {
                if (!((last_469780159 < (s_872416347).length) && !((ConstSet2[s_872416347[last_469780159]] != undefined)))) break Label5;
                  last_469780159 += 1;
                }
            } while (false);
            eolpos_469780160 = last_469780159;
            if ((last_469780159 < (s_872416347).length)) {
            if ((s_872416347[last_469780159] == 10)) {
            last_469780159 += 1;
            }
            else {
            if ((s_872416347[last_469780159] == 13)) {
            last_469780159 += 1;
            if (((last_469780159 < (s_872416347).length) && (s_872416347[last_469780159] == 10))) {
            last_469780159 += 1;
            }
            
            }
            }
            }
            
            if (false) {
            Temporary6 = (last_469780159 - 1);
            }
            else {
            Temporary6 = (eolpos_469780160 - 1);
            }
            
            line_872416352 = substr_33557907(s_872416347, first_469780158, Temporary6);
            if (!((i_872416351 == 0))) {
            result_872416350.push.apply(result_872416350, makeNimstrLit("\x0A"));;
            }
            
            Label7: do {
              var j_872416357 = 0;
              var colontmp__469780153 = 0;
              colontmp__469780153 = count_872416348;
              var res_469780154 = 1;
              Label8: do {
                  Label9: while (true) {
                  if (!(res_469780154 <= colontmp__469780153)) break Label9;
                    j_872416357 = res_469780154;
                    result_872416350.push.apply(result_872416350, padding_872416349);;
                    res_469780154 += 1;
                  }
              } while (false);
            } while (false);
            result_872416350.push.apply(result_872416350, line_872416352);;
            i_872416351 += 1;
            if ((eolpos_469780160 == last_469780159)) {
            break Label2;
            }
            
            first_469780158 = last_469780159;
          }
      } while (false);
    } while (false);

  return result_872416350;

}

function HEX5BHEX5D_956304536(s_956304539, x_956304540) {
  var result_956304541 = [];

    var a_956304543 = x_956304540.a;
    var L_956304545 = ((((s_956304539).length - x_956304540.b) - a_956304543) + 1);
    result_956304541 = nimCopy(null, mnewString(L_956304545), NTI33554439);
    Label1: do {
      var i_956304550 = 0;
      var i_469780164 = 0;
      Label2: do {
          Label3: while (true) {
          if (!(i_469780164 < L_956304545)) break Label3;
            i_956304550 = i_469780164;
            result_956304541[i_956304550] = s_956304539[(i_956304550 + a_956304543)];
            i_469780164 += 1;
          }
      } while (false);
    } while (false);

  return result_956304541;

}

function HEX2EHEX2E_905969744(a_905969747, b_905969748) {
  var result_905969751 = ({a: 0, b: 0});

    result_905969751 = nimCopy(result_905969751, {a: a_905969747, b: b_905969748}, NTI905969743);

  return result_905969751;

}

function instance_469765295(eHEX60gensym123_469765296) {
  var result_469765297 = 0;

    result_469765297 = entityStorage_469765280[0].entityComponents[eHEX60gensym123_469765296].instance;

  return result_469765297;

}

function hasComponent_469765331(entity_469765332, componentTypeId_469765333) {
      var Temporary1;
      var Temporary2;
      var Temporary3;
      var Temporary4;
      var Temporary5;

  var result_469765334 = false;

  BeforeRet: do {
    var entityId_469765335 = entity_469765332.Field0;
      if (!!(HEX3DHEX3D_1140851215(entity_469765332.Field0, 0))) Temporary4 = false; else {        Temporary4 = (1 <= ((entity_469765332.Field0) | 0));      }      if (!Temporary4) Temporary3 = false; else {        Temporary3 = (((entity_469765332.Field0) | 0) <= (entityStorage_469765280[0].entityComponents).length);      }      if (!Temporary3) Temporary2 = false; else {        Temporary2 = entityStorage_469765280[0].entityComponents[entity_469765332.Field0].setup;      }      if (!Temporary2) Temporary1 = false; else {        Temporary1 = (((entityStorage_469765280[0].entityComponents[entity_469765332.Field0].instance) | 0) == ((entity_469765332.Field1) | 0));      }    if (!(Temporary1)) {
    var strHEX60gensym125_469765340 = (makeNimstrLit("hasComponent on dead entity: ") || []).concat(HEX24_318767107(((entityId_469765335) | 0)) || [],makeNimstrLit(" instance ") || [],HEX24_318767107(((instance_469765295(entityId_469765335)) | 0)) || []);
      if (!(entity_469765332.Field0 == entityId_469765335)) Temporary5 = false; else {        Temporary5 = (entity_469765332.Field1 == entityStorage_469765280[0].entityComponents[entityId_469765335].instance);      }    if (!(Temporary5)) {
    strHEX60gensym125_469765340.push.apply(strHEX60gensym125_469765340, (makeNimstrLit(" expected instance ") || []).concat(HEX24_318767107(((entity_469765332.Field1) | 0)) || [],makeNimstrLit(" type ") || [],HEX24_318767107(((componentTypeId_469765333) | 0)) || []));;
    }
    
    }
    
    if (entityStorage_469765280[0].entityComponents[entityId_469765335].setup) {
    Label6: do {
      var cHEX60gensym124_469765363 = null;
      var colontmp__469780178 = [];
      colontmp__469780178 = entityStorage_469765280[0].entityComponents[entityId_469765335].componentRefs;
      var i_469780179 = 0;
      var L_469780180 = (colontmp__469780178).length;
      Label7: do {
          Label8: while (true) {
          if (!(i_469780179 < L_469780180)) break Label8;
            cHEX60gensym124_469765363 = colontmp__469780178[i_469780179];
            if (HEX3DHEX3D_1140851203(cHEX60gensym124_469765363.Field0, componentTypeId_469765333)) {
            result_469765334 = true;
            break BeforeRet;
            }
            
            i_469780179 += 1;
          }
      } while (false);
    } while (false);
    }
    
  } while (false);

  return result_469765334;

}

function contains_469765406(entityHEX60gensym125_469765407, componentTypeId_469765408) {
  var result_469765409 = false;

    result_469765409 = hasComponent_469765331(entityHEX60gensym125_469765407, componentTypeId_469765408);

  return result_469765409;

}

function hasKey_469763964(t_469763967, key_469763968) {
  var result_469763969 = false;

    var hc_469763970 = [0];
    result_469763969 = (0 <= rawGet_469763971(t_469763967, key_469763968, hc_469763970, 0));

  return result_469763969;

}

function HEX3DHEX3D_1140851219(e1_1140851220, e2_1140851221) {
    var Temporary1;

  var result_1140851222 = false;

    if (!(e1_1140851220.Field0 == e2_1140851221.Field0)) Temporary1 = false; else {      Temporary1 = (e1_1140851220.Field1 == e2_1140851221.Field1);    }    result_1140851222 = Temporary1;

  return result_1140851222;

}

function listSystems_469766138(entity_469766139) {
      var Temporary1;
      var Temporary2;
      var Temporary3;
      var Temporary4;
            var Temporary8;
    var Temporary9;
            var Temporary13;
    var Temporary14;
            var Temporary18;
    var Temporary19;

  var result_469766140 = [];

      if (!!(HEX3DHEX3D_1140851215(entity_469766139.Field0, 0))) Temporary4 = false; else {        Temporary4 = (1 <= ((entity_469766139.Field0) | 0));      }      if (!Temporary4) Temporary3 = false; else {        Temporary3 = (((entity_469766139.Field0) | 0) <= (entityStorage_469765280[0].entityComponents).length);      }      if (!Temporary3) Temporary2 = false; else {        Temporary2 = entityStorage_469765280[0].entityComponents[entity_469766139.Field0].setup;      }      if (!Temporary2) Temporary1 = false; else {        Temporary1 = (((entityStorage_469765280[0].entityComponents[entity_469766139.Field0].instance) | 0) == ((entity_469766139.Field1) | 0));      }    if (Temporary1) {
    var matchesEnt_469763203 = true;
    Label5: do {
      var reqHEX60gensym155_469766169 = 0;
      var i_469780168 = 0;
      Label6: do {
          Label7: while (true) {
          if (!true) break Label7;
            reqHEX60gensym155_469766169 = (Temporary8 = new Uint16Array([1, 2]), Temporary8)[i_469780168];
            if (!(contains_469765406(entity_469766139, reqHEX60gensym155_469766169))) {
            matchesEnt_469763203 = false;
            break Label5;
            }
            
            if ((1 <= i_469780168)) {
            break Label6;
            }
            
            i_469780168 += 1;
          }
      } while (false);
    } while (false);
    var inSysHEX60gensym156_469766215 = hasKey_469763964(sysMove_469763872[0].index, entity_469766139.Field0);
    if (!((matchesEnt_469763203 == inSysHEX60gensym156_469766215))) {
    if (matchesEnt_469763203) {
    Temporary9 = makeNimstrLit("[System]: entity contains the required components but is missing from the system index");
    }
    else {
    Temporary9 = makeNimstrLit("[Entity]: the system index references this entity but the entity doesn\'t have the required components");
    }
    
    var issueHEX60gensym156_469766216 = nimCopy(null, Temporary9, NTI33554439);
    result_469766140.push.apply(result_469766140, (makeNimstrLit("move (sysMove) Sync issue ") || []).concat(issueHEX60gensym156_469766216 || [],makeNimstrLit("\x0A") || []));;
    }
    else {
    if (inSysHEX60gensym156_469766215) {
    result_469766140.push.apply(result_469766140, makeNimstrLit("move (sysMove) \x0A"));;
    }
    }
    var matchesEnt_469763213 = true;
    Label10: do {
      var reqHEX60gensym158_469766221 = 0;
      var i_469780171 = 0;
      Label11: do {
          Label12: while (true) {
          if (!true) break Label12;
            reqHEX60gensym158_469766221 = (Temporary13 = new Uint16Array([2, 3]), Temporary13)[i_469780171];
            if (!(contains_469765406(entity_469766139, reqHEX60gensym158_469766221))) {
            matchesEnt_469763213 = false;
            break Label10;
            }
            
            if ((1 <= i_469780171)) {
            break Label11;
            }
            
            i_469780171 += 1;
          }
      } while (false);
    } while (false);
    var inSysHEX60gensym159_469766267 = hasKey_469763964(sysGravity_469764039[0].index, entity_469766139.Field0);
    if (!((matchesEnt_469763213 == inSysHEX60gensym159_469766267))) {
    if (matchesEnt_469763213) {
    Temporary14 = makeNimstrLit("[System]: entity contains the required components but is missing from the system index");
    }
    else {
    Temporary14 = makeNimstrLit("[Entity]: the system index references this entity but the entity doesn\'t have the required components");
    }
    
    var issueHEX60gensym159_469766268 = nimCopy(null, Temporary14, NTI33554439);
    result_469766140.push.apply(result_469766140, (makeNimstrLit("gravity (sysGravity) Sync issue ") || []).concat(issueHEX60gensym159_469766268 || [],makeNimstrLit("\x0A") || []));;
    }
    else {
    if (inSysHEX60gensym159_469766267) {
    result_469766140.push.apply(result_469766140, makeNimstrLit("gravity (sysGravity) \x0A"));;
    }
    }
    var matchesEnt_469763217 = true;
    Label15: do {
      var reqHEX60gensym161_469766294 = 0;
      var i_469780175 = 0;
      Label16: do {
          Label17: while (true) {
          if (!true) break Label17;
            reqHEX60gensym161_469766294 = (Temporary18 = new Uint16Array([1, 2, 4]), Temporary18)[i_469780175];
            if (!(contains_469765406(entity_469766139, reqHEX60gensym161_469766294))) {
            matchesEnt_469763217 = false;
            break Label15;
            }
            
            if ((2 <= i_469780175)) {
            break Label16;
            }
            
            i_469780175 += 1;
          }
      } while (false);
    } while (false);
    var inSysHEX60gensym162_469766340 = hasKey_469763964(sysBounce_469764129[0].index, entity_469766139.Field0);
    if (!((matchesEnt_469763217 == inSysHEX60gensym162_469766340))) {
    if (matchesEnt_469763217) {
    Temporary19 = makeNimstrLit("[System]: entity contains the required components but is missing from the system index");
    }
    else {
    Temporary19 = makeNimstrLit("[Entity]: the system index references this entity but the entity doesn\'t have the required components");
    }
    
    var issueHEX60gensym162_469766341 = nimCopy(null, Temporary19, NTI33554439);
    result_469766140.push.apply(result_469766140, (makeNimstrLit("bounce (sysBounce) Sync issue ") || []).concat(issueHEX60gensym162_469766341 || [],makeNimstrLit("\x0A") || []));;
    }
    else {
    if (inSysHEX60gensym162_469766340) {
    result_469766140.push.apply(result_469766140, makeNimstrLit("bounce (sysBounce) \x0A"));;
    }
    }
    }
    else {
      if (HEX3DHEX3D_1140851219(entity_469766139, NO_ENTITY_REF_1140851124)) {
      result_469766140 = nimCopy(null, makeNimstrLit("<Entity is NO_ENTITY_REF>"), NTI33554439);
      }
      else {
        result_469766140 = nimCopy(null, makeNimstrLit("<Entity is not alive>"), NTI33554439);
      }
      
    }
    

  return result_469766140;

}

function HEX24_469766508(entity_469766509, showDataHEX60gensym165_469766510) {
      var Temporary1;
      var Temporary2;
      var Temporary3;
      var Temporary4;
      var Temporary5;
      var Temporary6;
      var Temporary7;
      var Temporary8;

  var result_469766511 = [];

    var idHEX60gensym165_469766512 = ((entity_469766509.Field0) | 0);
    var compCountHEX60gensym165_469766513 = componentCount_469765468(entity_469766509);
    result_469766511 = nimCopy(null, (makeNimstrLit("[EntityId: ") || []).concat(HEX24_318767107(idHEX60gensym165_469766512) || []), NTI33554439);
      if ((idHEX60gensym165_469766512 < 1)) Temporary1 = true; else {        Temporary1 = ((entityStorage_469765280[0].entityComponents).length < idHEX60gensym165_469766512);      }    if (Temporary1) {
    result_469766511.push.apply(result_469766511, makeNimstrLit(" Out of bounds!]"));;
    }
    else {
      var compsStrHEX60gensym165_469766517 = listComponents_469766360(entity_469766509, showDataHEX60gensym165_469766510);
      if ((0 < compCountHEX60gensym165_469766513)) {
      Temporary2 = (makeNimstrLit("\x0A") || []).concat(nsuIndent(HEX5BHEX5D_956304536(compsStrHEX60gensym165_469766517, HEX2EHEX2E_905969744(0, 2)), 2, makeNimstrLit(" ")) || []);
      }
      else {
      Temporary2 = makeNimstrLit(" <None>");
      }
      
      var compsIndentedHEX60gensym165_469766536 = nimCopy(null, Temporary2, NTI33554439);
      var systemsStrHEX60gensym165_469766537 = listSystems_469766138(entity_469766509);
      if ((0 < (systemsStrHEX60gensym165_469766537).length)) {
      Temporary3 = (makeNimstrLit("\x0A") || []).concat(nsuIndent(HEX5BHEX5D_956304536(systemsStrHEX60gensym165_469766537, HEX2EHEX2E_905969744(0, 2)), 2, makeNimstrLit(" ")) || []);
      }
      else {
      Temporary3 = makeNimstrLit(" <None>");
      }
      
      var sysIndentedHEX60gensym165_469766556 = nimCopy(null, Temporary3, NTI33554439);
      if (!(!(HEX3DHEX3D_1140851215(entity_469766509.Field0, 0)))) {
      Temporary4 = makeNimstrLit(" INVALID/NULL ENTITY ID");
      }
      else {
      Temporary4 = [];
      }
      
      var invalidStrHEX60gensym165_469766557 = nimCopy(null, Temporary4, NTI33554439);
      if (!!(HEX3DHEX3D_1140851215(entity_469766509.Field0, 0))) Temporary8 = false; else {        Temporary8 = (1 <= ((entity_469766509.Field0) | 0));      }      if (!Temporary8) Temporary7 = false; else {        Temporary7 = (((entity_469766509.Field0) | 0) <= (entityStorage_469765280[0].entityComponents).length);      }      if (!Temporary7) Temporary6 = false; else {        Temporary6 = entityStorage_469765280[0].entityComponents[entity_469766509.Field0].setup;      }      if (!Temporary6) Temporary5 = false; else {        Temporary5 = (((entityStorage_469765280[0].entityComponents[entity_469766509.Field0].instance) | 0) == ((entity_469766509.Field1) | 0));      }      result_469766511.push.apply(result_469766511, (makeNimstrLit(" (generation: ") || []).concat(HEX24_318767107(((entity_469766509.Field1) | 0)) || [],makeNimstrLit(")") || [],invalidStrHEX60gensym165_469766557 || [],makeNimstrLit("\x0AAlive: ") || [],nimBoolToStr(Temporary5) || [],makeNimstrLit("\x0AComponents:") || [],compsIndentedHEX60gensym165_469766536 || [],makeNimstrLit("\x0ASystems:") || [],sysIndentedHEX60gensym165_469766556 || [],makeNimstrLit("\x0A]") || []));;
    }
    

  return result_469766511;

}
var sysMove_469763872 = [({id: 0, lastIndex: 0, streamRate: 0, systemName: [], disabled: false, paused: false, initialised: false, deleteList: [], requirements: [0, 0], groups: [], index: ({data: [], counter: 0})})];
initMoveSystem_469763875(sysMove_469763872[0]);
var sysGravity_469764039 = [({id: 0, lastIndex: 0, streamRate: 0, systemName: [], disabled: false, paused: false, initialised: false, deleteList: [], requirements: [0, 0], groups: [], index: ({data: [], counter: 0})})];
initGravitySystem_469764042(sysGravity_469764039[0]);
var sysBounce_469764129 = [({id: 0, lastIndex: 0, streamRate: 0, systemName: [], disabled: false, paused: false, initialised: false, deleteList: [], requirements: [0, 0, 0], groups: [], index: ({data: [], counter: 0})})];
initBounceSystem_469764132(sysBounce_469764129[0]);
var storagePos_469764205 = [[]];
var posFreeIndexes_469764206 = [[]];
var posNextIndex_469764207 = [0];
var posAlive_469764208 = [[]];
var posInstanceIds_469764209 = [[]];
var storageVel_469764210 = [[]];
var velFreeIndexes_469764211 = [[]];
var velNextIndex_469764212 = [0];
var velAlive_469764213 = [[]];
var velInstanceIds_469764214 = [[]];
var storageGravity_469764215 = [[]];
var gravityFreeIndexes_469764216 = [[]];
var gravityNextIndex_469764217 = [0];
var gravityAlive_469764218 = [[]];
var gravityInstanceIds_469764219 = [[]];
var storageBounce_469764220 = [[]];
var bounceFreeIndexes_469764221 = [[]];
var bounceNextIndex_469764222 = [0];
var bounceAlive_469764223 = [[]];
var bounceInstanceIds_469764224 = [[]];
if (storagePos_469764205[0].length < 1) { for (var i = storagePos_469764205[0].length ; i < 1 ; ++i) storagePos_469764205[0].push(({x: 0.0, y: 0.0})); }
               else { storagePos_469764205[0].length = 1; };
if (posAlive_469764208[0].length < 1) { for (var i = posAlive_469764208[0].length ; i < 1 ; ++i) posAlive_469764208[0].push(false); }
               else { posAlive_469764208[0].length = 1; };
if (posInstanceIds_469764209[0].length < 1) { for (var i = posInstanceIds_469764209[0].length ; i < 1 ; ++i) posInstanceIds_469764209[0].push(0); }
               else { posInstanceIds_469764209[0].length = 1; };
posNextIndex_469764207[0] = 1;
if (storageVel_469764210[0].length < 1) { for (var i = storageVel_469764210[0].length ; i < 1 ; ++i) storageVel_469764210[0].push(({x: 0.0, y: 0.0})); }
               else { storageVel_469764210[0].length = 1; };
if (velAlive_469764213[0].length < 1) { for (var i = velAlive_469764213[0].length ; i < 1 ; ++i) velAlive_469764213[0].push(false); }
               else { velAlive_469764213[0].length = 1; };
if (velInstanceIds_469764214[0].length < 1) { for (var i = velInstanceIds_469764214[0].length ; i < 1 ; ++i) velInstanceIds_469764214[0].push(0); }
               else { velInstanceIds_469764214[0].length = 1; };
velNextIndex_469764212[0] = 1;
if (storageGravity_469764215[0].length < 1) { for (var i = storageGravity_469764215[0].length ; i < 1 ; ++i) storageGravity_469764215[0].push(({strength: 0.0})); }
               else { storageGravity_469764215[0].length = 1; };
if (gravityAlive_469764218[0].length < 1) { for (var i = gravityAlive_469764218[0].length ; i < 1 ; ++i) gravityAlive_469764218[0].push(false); }
               else { gravityAlive_469764218[0].length = 1; };
if (gravityInstanceIds_469764219[0].length < 1) { for (var i = gravityInstanceIds_469764219[0].length ; i < 1 ; ++i) gravityInstanceIds_469764219[0].push(0); }
               else { gravityInstanceIds_469764219[0].length = 1; };
gravityNextIndex_469764217[0] = 1;
if (storageBounce_469764220[0].length < 1) { for (var i = storageBounce_469764220[0].length ; i < 1 ; ++i) storageBounce_469764220[0].push(({})); }
               else { storageBounce_469764220[0].length = 1; };
if (bounceAlive_469764223[0].length < 1) { for (var i = bounceAlive_469764223[0].length ; i < 1 ; ++i) bounceAlive_469764223[0].push(false); }
               else { bounceAlive_469764223[0].length = 1; };
if (bounceInstanceIds_469764224[0].length < 1) { for (var i = bounceInstanceIds_469764224[0].length ; i < 1 ; ++i) bounceInstanceIds_469764224[0].push(0); }
               else { bounceInstanceIds_469764224[0].length = 1; };
bounceNextIndex_469764222[0] = 1;
var entityStorage_469765280 = [({entityComponents: [], entityCounter: 0, entityRecycler: [], nextEntityId: 0})];
initEntityStorage_469765278(entityStorage_469765280[0]);
var manualConstruct_469768831 = [[null, null, null, null]];
var postConstruct_469768832 = [[null, null, null, null]];
var cloneConstruct_469768833 = [[null, null, null, null]];
Label1: do {
  var entity_469779641 = newEntity_469765482();
  var pos__n0L4MHhcwf270NdUpXnneQ_469779756 = [newInstance_469764428({x: 0.0, y: 0.0})];
  var vel__n0L4MHhcwf270NdUpXnneQ_469779757 = [newInstance_469764663({x: 1.0, y: 1.0})];
  var gravity__n0L4MHhcwf270NdUpXnneQ_469779758 = [newInstance_469764898({strength: 1.0})];
  var bounce__n0L4MHhcwf270NdUpXnneQ_469779759 = [newInstance_469765133({})];
  var row_469779716 = [0];
  sysMove_469763872[0].groups.push({entity: nimCopy(null, entity_469779641, NTI1140850875), pos: pos__n0L4MHhcwf270NdUpXnneQ_469779756[0], vel: vel__n0L4MHhcwf270NdUpXnneQ_469779757[0]});;
  row_469779716[0] = (sysMove_469763872[0].groups).length - 1;
  HEX5BHEX5DHEX3D_469767160(sysMove_469763872[0].index, entity_469779641.Field0, row_469779716[0]);
  var row_469779717 = [0];
  sysBounce_469764129[0].groups.push({entity: nimCopy(null, entity_469779641, NTI1140850875), pos: pos__n0L4MHhcwf270NdUpXnneQ_469779756[0], vel: vel__n0L4MHhcwf270NdUpXnneQ_469779757[0], bounce: bounce__n0L4MHhcwf270NdUpXnneQ_469779759[0]});;
  row_469779717[0] = (sysBounce_469764129[0].groups).length - 1;
  HEX5BHEX5DHEX3D_469767160(sysBounce_469764129[0].index, entity_469779641.Field0, row_469779717[0]);
  var row_469779725 = [0];
  sysGravity_469764039[0].groups.push({entity: nimCopy(null, entity_469779641, NTI1140850875), vel: vel__n0L4MHhcwf270NdUpXnneQ_469779757[0], gravity: gravity__n0L4MHhcwf270NdUpXnneQ_469779758[0]});;
  row_469779725[0] = (sysGravity_469764039[0].groups).length - 1;
  HEX5BHEX5DHEX3D_469767160(sysGravity_469764039[0].index, entity_469779641.Field0, row_469779725[0]);
  var iHEX60gensym69HEX60gensym1652_469779958 = pos__n0L4MHhcwf270NdUpXnneQ_469779756[0];
  var Temporary2 = nimCopy(null, {Field0: 1, Field1: iHEX60gensym69HEX60gensym1652_469779958, Field2: posInstanceIds_469764209[0][iHEX60gensym69HEX60gensym1652_469779958]}, NTI1140850884);
  entityStorage_469765280[0].entityComponents[entity_469779641.Field0].componentRefs.push(Temporary2);;
  var iHEX60gensym83HEX60gensym1656_469779965 = vel__n0L4MHhcwf270NdUpXnneQ_469779757[0];
  var Temporary3 = nimCopy(null, {Field0: 2, Field1: iHEX60gensym83HEX60gensym1656_469779965, Field2: velInstanceIds_469764214[0][iHEX60gensym83HEX60gensym1656_469779965]}, NTI1140850884);
  entityStorage_469765280[0].entityComponents[entity_469779641.Field0].componentRefs.push(Temporary3);;
  var iHEX60gensym97HEX60gensym1660_469779972 = gravity__n0L4MHhcwf270NdUpXnneQ_469779758[0];
  var Temporary4 = nimCopy(null, {Field0: 3, Field1: iHEX60gensym97HEX60gensym1660_469779972, Field2: gravityInstanceIds_469764219[0][iHEX60gensym97HEX60gensym1660_469779972]}, NTI1140850884);
  entityStorage_469765280[0].entityComponents[entity_469779641.Field0].componentRefs.push(Temporary4);;
  var iHEX60gensym111HEX60gensym1664_469779979 = bounce__n0L4MHhcwf270NdUpXnneQ_469779759[0];
  var Temporary5 = nimCopy(null, {Field0: 4, Field1: iHEX60gensym111HEX60gensym1664_469779979, Field2: bounceInstanceIds_469764224[0][iHEX60gensym111HEX60gensym1664_469779979]}, NTI1140850884);
  entityStorage_469765280[0].entityComponents[entity_469779641.Field0].componentRefs.push(Temporary5);;
} while (false);
var ball_469779989 = nimCopy(null, entity_469779641, NTI1140850875);
Label6: do {
  var i_469779994 = [0];
  var i_469780078 = 0;
  Label7: do {
      Label8: while (true) {
      if (!(i_469780078 < 4)) break Label8;
        i_469779994[0] = i_469780078;
        run_469779586();
        rawEcho(HEX24_469766508(ball_469779989, true));
        i_469780078 += 1;
      }
  } while (false);
} while (false);
</script>
</main>
<footer>
<hr>
<div class="nb-box">
  <span><span class="nb-small">made with <a href="https://pietroppeter.github.io/nimib/">nimib üê≥</a></span></span>
  <span></span>
  <span><button class="nb-small" id="show" onclick="toggleSourceDisplay()">Show Source</button></span>
</div>
</footer>
<section id="source">
<pre><code class="nim hljs"><span class="hljs-keyword">import</span> nimib

nbInit
nbText: <span class="hljs-string">&quot;&quot;&quot;
Trying to use [polymorph] with nim js backend.
It does not work. File created to submit an issue.

The following code is executed by nimib
both using c backend and js backend.

If you open the browser console you will see that with js backend:
- it starts with Pos (0, 0) instead of (1, 1) (and wrong velociy)
- at each step neither move nor gravity are applied, only bounce is applied.

[polymorph]: https://github.com/rlipsc/polymorph
&quot;&quot;&quot;</span>
<span class="hljs-comment">#[ this template is broken because nbCode's code reading does not work! fun to see!
template nbJsAndCode(body: untyped) =
  nbCode:
    body
  nbJsFromCode:
    body
]#</span>
nbCode:
  <span class="hljs-keyword">import</span> polymorph

  <span class="hljs-comment"># Parse some types as components.</span>
  register defaultCompOpts:
    <span class="hljs-keyword">type</span>
      <span class="hljs-type">Pos</span> = <span class="hljs-keyword">object</span>
        x, y: <span class="hljs-built_in">float</span>
      <span class="hljs-type">Vel</span> = <span class="hljs-keyword">object</span>
        x, y: <span class="hljs-built_in">float</span>
      <span class="hljs-type">Gravity</span> = <span class="hljs-keyword">object</span>
        strength: <span class="hljs-built_in">float</span>
      <span class="hljs-type">Bounce</span> = <span class="hljs-keyword">object</span>   <span class="hljs-comment"># A dataless 'tag' component.</span>

  makeSystem <span class="hljs-string">&quot;move&quot;</span>, [<span class="hljs-type">Pos</span>, <span class="hljs-type">Vel</span>]:
    <span class="hljs-comment"># Calculate basic movement.</span>
    all:
      <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;move&quot;</span>
      pos.x += vel.x
      pos.y += vel.y

  makeSystem <span class="hljs-string">&quot;gravity&quot;</span>, [<span class="hljs-type">Vel</span>, <span class="hljs-type">Gravity</span>]:
    <span class="hljs-comment"># Apply a gravity force to 'Vel'.</span>
    all:
      vel.y -= gravity.strength

  makeSystem <span class="hljs-string">&quot;bounce&quot;</span>, [<span class="hljs-type">Pos</span>, <span class="hljs-type">Vel</span>, <span class="hljs-type">Bounce</span>]:
    all:
      <span class="hljs-comment"># Correct 'Pos.y' to never goes below zero, enacting a simple bounce</span>
      <span class="hljs-comment"># to 'Vel.y' if this occurs.</span>
      <span class="hljs-keyword">if</span> pos.y &lt;= <span class="hljs-number">0.0</span>:
        pos.y = <span class="hljs-number">0.0</span>
        vel.y = abs(vel.y) * <span class="hljs-number">0.5</span>

  <span class="hljs-comment"># Generate the framework and system procedures.</span>
  makeEcsCommit <span class="hljs-string">&quot;run&quot;</span>

  <span class="hljs-keyword">let</span>
    ball = newEntityWith(
      <span class="hljs-type">Pos</span>(x: <span class="hljs-number">0.0</span>, y: <span class="hljs-number">0.0</span>),
      <span class="hljs-type">Vel</span>(x: <span class="hljs-number">1.0</span>, y: <span class="hljs-number">1.0</span>),
      <span class="hljs-type">Gravity</span>(strength: <span class="hljs-number">1.0</span>),
      <span class="hljs-type">Bounce</span>()
    ) 

  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> ..&lt; <span class="hljs-number">4</span>:
    run()
    <span class="hljs-keyword">echo</span> ball


nbJsFromCode:
  <span class="hljs-keyword">import</span> polymorph

  <span class="hljs-comment"># Parse some types as components.</span>
  register defaultCompOpts:
    <span class="hljs-keyword">type</span>
      <span class="hljs-type">Pos</span> = <span class="hljs-keyword">object</span>
        x, y: <span class="hljs-built_in">float</span>
      <span class="hljs-type">Vel</span> = <span class="hljs-keyword">object</span>
        x, y: <span class="hljs-built_in">float</span>
      <span class="hljs-type">Gravity</span> = <span class="hljs-keyword">object</span>
        strength: <span class="hljs-built_in">float</span>
      <span class="hljs-type">Bounce</span> = <span class="hljs-keyword">object</span>   <span class="hljs-comment"># A dataless 'tag' component.</span>

  makeSystem <span class="hljs-string">&quot;move&quot;</span>, [<span class="hljs-type">Pos</span>, <span class="hljs-type">Vel</span>]:
    <span class="hljs-comment"># Calculate basic movement.</span>
    all:
      <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;move&quot;</span>
      pos.x += vel.x
      pos.y += vel.y

  makeSystem <span class="hljs-string">&quot;gravity&quot;</span>, [<span class="hljs-type">Vel</span>, <span class="hljs-type">Gravity</span>]:
    <span class="hljs-comment"># Apply a gravity force to 'Vel'.</span>
    all:
      vel.y -= gravity.strength

  makeSystem <span class="hljs-string">&quot;bounce&quot;</span>, [<span class="hljs-type">Pos</span>, <span class="hljs-type">Vel</span>, <span class="hljs-type">Bounce</span>]:
    all:
      <span class="hljs-comment"># Correct 'Pos.y' to never goes below zero, enacting a simple bounce</span>
      <span class="hljs-comment"># to 'Vel.y' if this occurs.</span>
      <span class="hljs-keyword">if</span> pos.y &lt;= <span class="hljs-number">0.0</span>:
        pos.y = <span class="hljs-number">0.0</span>
        vel.y = abs(vel.y) * <span class="hljs-number">0.5</span>

  <span class="hljs-comment"># Generate the framework and system procedures.</span>
  makeEcsCommit <span class="hljs-string">&quot;run&quot;</span>

  <span class="hljs-keyword">let</span>
    ball = newEntityWith(
      <span class="hljs-type">Pos</span>(x: <span class="hljs-number">0.0</span>, y: <span class="hljs-number">0.0</span>),
      <span class="hljs-type">Vel</span>(x: <span class="hljs-number">1.0</span>, y: <span class="hljs-number">1.0</span>),
      <span class="hljs-type">Gravity</span>(strength: <span class="hljs-number">1.0</span>),
      <span class="hljs-type">Bounce</span>()
    ) 

  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> ..&lt; <span class="hljs-number">4</span>:
    run()
    <span class="hljs-keyword">echo</span> ball
nbSave</code></pre>
</section><script>
function toggleSourceDisplay() {
  var btn = document.getElementById("show")
  var source = document.getElementById("source");
  if (btn.innerHTML=="Show Source") {
    btn.innerHTML = "Hide Source";
    source.style.display = "block";
  } else {
    btn.innerHTML = "Show Source";
    source.style.display = "none";
  }
}
</script></body>
</html>